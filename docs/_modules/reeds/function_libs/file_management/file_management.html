

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>reeds.function_libs.file_management.file_management &mdash; REEDS  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> REEDS
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">RE-EDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_source/modules.html">reeds</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">REEDS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>reeds.function_libs.file_management.file_management</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for reeds.function_libs.file_management.file_management</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This module is doing all the post simulation file juggling needed for gromos.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">tempfile</span><span class="o">,</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mult</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">reeds</span>
<span class="kn">from</span> <span class="nn">pygromos.files</span> <span class="kn">import</span> <span class="n">repdat</span><span class="p">,</span> <span class="n">imd</span>
<span class="kn">from</span> <span class="nn">pygromos.files.energy</span> <span class="kn">import</span> <span class="n">tre</span>
<span class="kn">from</span> <span class="nn">pygromos.gromos</span> <span class="kn">import</span> <span class="n">gromosPP</span>
<span class="kn">from</span> <span class="nn">pygromos.utils</span> <span class="kn">import</span> <span class="n">bash</span>

<span class="kn">from</span> <span class="nn">reeds.function_libs.utils.structures</span> <span class="kn">import</span> <span class="n">adding_Scheme_new_Replicas</span> <span class="k">as</span> <span class="n">add_scheme</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PARALLEL WORKER - These functions are required for parallelized code Execution</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="_thread_worker_cat_trc"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management._thread_worker_cat_trc">[docs]</a><span class="k">def</span> <span class="nf">_thread_worker_cat_trc</span><span class="p">(</span><span class="n">job</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                           <span class="n">replicaID_range</span><span class="p">:</span> <span class="p">(</span><span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]),</span>
                           <span class="n">trc_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                           <span class="n">out_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">topology_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">out_trcs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                           <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                           <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                           <span class="n">boundary_conditions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r cog&quot;</span><span class="p">,</span>
                           <span class="n">include_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;_thread_worker_cat_trc</span>
<span class="sd">        This thread worker_scripts concatenates all .trc files of one replica into one file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    job : int</span>
<span class="sd">        rank of this thread</span>
<span class="sd">    replicaID_range : (Iterable, List[int])</span>
<span class="sd">        x_range - list of all</span>
<span class="sd">    trc_files : Dict[int, List[str]]</span>
<span class="sd">        Dictionary containing all replicas, with list of all trc files concerning one trc.</span>
<span class="sd">    out_prefix : str</span>
<span class="sd">        output prefix</span>
<span class="sd">    topology_path : str</span>
<span class="sd">        path to the topology file</span>
<span class="sd">    out_trcs : dict</span>
<span class="sd">        output trajectories</span>
<span class="sd">    dt : float</span>
<span class="sd">        timestep</span>
<span class="sd">    time : float, optional</span>
<span class="sd">        start time (default 0)</span>
<span class="sd">    boundary_conditions : str, optional</span>
<span class="sd">        boundary conditions (default &quot;r cog&quot;)</span>
<span class="sd">    include_all : bool, optional</span>
<span class="sd">        include SOLVENT? (default: False)</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        verbosity?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gromPP</span> <span class="o">=</span> <span class="n">gromosPP</span><span class="o">.</span><span class="n">GromosPP</span><span class="p">()</span>
    <span class="n">start_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: range &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">replicaID_range</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">replicaID</span> <span class="ow">in</span> <span class="n">replicaID_range</span><span class="p">:</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">out_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">replicaID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.trc&quot;</span>
        <span class="n">compress_out_path</span> <span class="o">=</span> <span class="n">out_path</span> <span class="o">+</span> <span class="s2">&quot;.gz&quot;</span>

        <span class="n">out_trcs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">replicaID</span><span class="p">:</span> <span class="n">compress_out_path</span><span class="p">})</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">compress_out_path</span><span class="p">)):</span>  <span class="c1"># found perfect compressed trc file:)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Skipped generating file as I found: &quot;</span> <span class="o">+</span> <span class="n">compress_out_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_path</span><span class="p">)):</span>
                <span class="n">bash</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_path</span><span class="p">)):</span>  <span class="c1"># did not find compressed file. will compress</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Skipped generating file as I found: &quot;</span> <span class="o">+</span> <span class="n">out_path</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># concat files</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="s2">&quot;write out &quot;</span> <span class="o">+</span> <span class="n">out_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
            <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">bash</span><span class="o">.</span><span class="n">make_folder</span><span class="p">(</span><span class="n">out_dir</span> <span class="o">+</span> <span class="s2">&quot;/TMP_replica_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">replicaID</span><span class="p">),</span> <span class="n">additional_option</span><span class="o">=</span><span class="s2">&quot;-p&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">include_all</span><span class="p">):</span>
                <span class="n">out_path</span> <span class="o">=</span> <span class="n">gromPP</span><span class="o">.</span><span class="n">frameout</span><span class="p">(</span><span class="n">in_top_path</span><span class="o">=</span><span class="n">topology_path</span><span class="p">,</span> <span class="n">in_coord_path</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">trc_files</span><span class="p">[</span><span class="n">replicaID</span><span class="p">]),</span>
                                           <span class="n">periodic_boundary_condition</span><span class="o">=</span><span class="n">boundary_conditions</span><span class="p">,</span> <span class="n">single_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">out_file_format</span><span class="o">=</span><span class="s2">&quot;trc&quot;</span><span class="p">,</span>
                                           <span class="n">out_file_path</span><span class="o">=</span><span class="n">out_path</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="s2">&quot;ALL&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_path</span> <span class="o">=</span> <span class="n">gromPP</span><span class="o">.</span><span class="n">frameout</span><span class="p">(</span><span class="n">in_top_path</span><span class="o">=</span><span class="n">topology_path</span><span class="p">,</span> <span class="n">in_coord_path</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">trc_files</span><span class="p">[</span><span class="n">replicaID</span><span class="p">]),</span>
                                           <span class="n">periodic_boundary_condition</span><span class="o">=</span><span class="n">boundary_conditions</span><span class="p">,</span> <span class="n">single_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">out_file_format</span><span class="o">=</span><span class="s2">&quot;trc&quot;</span><span class="p">,</span>
                                           <span class="n">out_file_path</span><span class="o">=</span><span class="n">out_path</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">start_dir</span><span class="p">)</span>
            <span class="n">bash</span><span class="o">.</span><span class="n">wait_for_fileSystem</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
            <span class="n">bash</span><span class="o">.</span><span class="n">remove_folder</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="s2">&quot;write out &quot;</span> <span class="o">+</span> <span class="n">out_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> DONE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="s2">&quot;compress &quot;</span> <span class="o">+</span> <span class="n">compress_out_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">compressed_trc</span> <span class="o">=</span> <span class="n">bash</span><span class="o">.</span><span class="n">compress_gzip</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">compress_out_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="s2">&quot;compress &quot;</span> <span class="o">+</span> <span class="n">compressed_trc</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> DONE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="_thread_worker_cat_tre"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management._thread_worker_cat_tre">[docs]</a><span class="k">def</span> <span class="nf">_thread_worker_cat_tre</span><span class="p">(</span><span class="n">job</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                           <span class="n">replicaID_range</span><span class="p">:</span> <span class="p">(</span><span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]),</span>
                           <span class="n">tre_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                           <span class="n">out_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">out_tres</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;_thread_worker_cat_tre</span>
<span class="sd">    This functions concatenates energy trajectories</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    job : int</span>
<span class="sd">        rank of this thread</span>
<span class="sd">    replicaID_range : (Iterable, List[int])</span>
<span class="sd">        x_range - list of all</span>
<span class="sd">    tre_files : Dict[int, List[str]]</span>
<span class="sd">        energy trajectory files</span>
<span class="sd">    out_prefix : str</span>
<span class="sd">        prefix for output files</span>
<span class="sd">    out_tres : dict</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: range &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">replicaID_range</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">replicaID</span> <span class="ow">in</span> <span class="n">replicaID_range</span><span class="p">:</span>
        <span class="n">use_tre_file_paths</span><span class="p">,</span> <span class="n">unarchived_files</span> <span class="o">=</span> <span class="n">find_and_unarchive_tar_files</span><span class="p">(</span><span class="n">tre_files</span><span class="p">[</span><span class="n">replicaID</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FILES: &quot;</span><span class="p">,</span> <span class="n">use_tre_file_paths</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Archs:&quot;</span><span class="p">,</span> <span class="n">unarchived_files</span><span class="p">)</span>

        <span class="n">out_path</span> <span class="o">=</span> <span class="n">out_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">replicaID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.tre&quot;</span>
        <span class="n">compressed_tre</span> <span class="o">=</span> <span class="n">out_path</span> <span class="o">+</span> <span class="s2">&quot;.gz&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">compressed_tre</span><span class="p">)):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Skipped generating .tre.gz file as I found: &quot;</span> <span class="o">+</span> <span class="n">out_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_path</span><span class="p">)):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Skipped generating .tre file as I found: &quot;</span> <span class="o">+</span> <span class="n">out_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2"> Continue Compressing.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tre_file</span> <span class="o">=</span> <span class="n">tre</span><span class="o">.</span><span class="n">Tre</span><span class="p">(</span><span class="n">use_tre_file_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: parsing &quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">use_tre_file_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">use_tre_file_paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">tre_file_path</span> <span class="ow">in</span> <span class="n">use_tre_file_paths</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: append &quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">tre_file_path</span><span class="p">))</span>
                        <span class="n">tre_file</span><span class="o">.</span><span class="n">append_tre</span><span class="p">(</span><span class="n">tre</span><span class="o">.</span><span class="n">Tre</span><span class="p">(</span><span class="n">tre_file_path</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: write out &quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span>
                <span class="n">tre_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
                <span class="n">bash</span><span class="o">.</span><span class="n">wait_for_fileSystem</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: done &quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span>
                <span class="k">del</span> <span class="n">tre_file</span>

                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:  compress &quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span>
                <span class="n">compressed_tre</span> <span class="o">=</span> <span class="n">bash</span><span class="o">.</span><span class="n">compress_gzip</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">compressed_tre</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="s2">&quot;compress &quot;</span> <span class="o">+</span> <span class="n">compressed_tre</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> DONE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># file cleaning:</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">use_tre_file_paths</span><span class="p">:</span>
            <span class="n">bash</span><span class="o">.</span><span class="n">compress_gzip</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">out_tres</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">replicaID</span><span class="p">:</span> <span class="n">compressed_tre</span><span class="p">})</span></div>


<div class="viewcode-block" id="thread_worker_concat_repdat"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.thread_worker_concat_repdat">[docs]</a><span class="k">def</span> <span class="nf">thread_worker_concat_repdat</span><span class="p">(</span><span class="n">job</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="n">repdat_file_out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">repdat_file_paths</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
                                <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;thread_worker_concat_repdat</span>
<span class="sd">    This function concatenates repdat files</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    job : int</span>
<span class="sd">        rank of this thread</span>
<span class="sd">    repdat_file_out_path : str</span>
<span class="sd">        output path for concatenated repdat files</span>
<span class="sd">    repdat_file_paths : (str, List[str])</span>
<span class="sd">        path to repdat files</span>
<span class="sd">    verbose : bool, optional  </span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">repdat_file_out_path</span><span class="p">)):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Skipped repdat creation as already existed!: &quot;</span> <span class="o">+</span> <span class="n">repdat_file_out_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: Found repdats: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">repdat_file_paths</span><span class="p">))</span>  <span class="c1"># verbose_repdat</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">repdat_file_paths</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="n">repdat_file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">repdat_file_paths</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: Concatenate repdats: </span><span class="se">\t</span><span class="s2">START&quot;</span><span class="p">)</span>  <span class="c1"># verbose_repdat</span>
        <span class="n">repdat_file</span> <span class="o">=</span> <span class="n">repdat</span><span class="o">.</span><span class="n">Repdat</span><span class="p">(</span><span class="n">repdat_file_paths</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>  <span class="c1"># repdat Class</span>
        <span class="k">for</span> <span class="n">repdat_path</span> <span class="ow">in</span> <span class="n">repdat_file_paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: concat:</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">repdat_path</span><span class="p">)</span>
            <span class="n">tmp_repdat_file</span> <span class="o">=</span> <span class="n">repdat</span><span class="o">.</span><span class="n">Repdat</span><span class="p">(</span><span class="n">repdat_path</span><span class="p">)</span>
            <span class="n">repdat_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_repdat_file</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">tmp_repdat_file</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: Concatenate repdats: </span><span class="se">\t</span><span class="s2">DONE&quot;</span><span class="p">)</span>  <span class="c1"># verbose_repdat</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: Write out repdat: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">repdat_file_out_path</span><span class="p">))</span>  <span class="c1"># verbose_repdat</span>
        <span class="n">repdat_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">repdat_file_out_path</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">repdat_file</span></div>


<div class="viewcode-block" id="_thread_worker_cnfs"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management._thread_worker_cnfs">[docs]</a><span class="k">def</span> <span class="nf">_thread_worker_cnfs</span><span class="p">(</span><span class="n">job</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">out_cnfs</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                        <span class="n">in_cnfs</span> <span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]),</span>
                        <span class="n">replica_range</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                        <span class="n">out_folder</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;_thread_worker_cnfs</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    job : int</span>
<span class="sd">        rank of this thread</span>
<span class="sd">    out_cnfs : dict</span>
<span class="sd">    in_cnfs : (str, List[str])</span>
<span class="sd">        list of input cnf files</span>
<span class="sd">    replica_range : List[int]</span>
<span class="sd">        list of replica IDs</span>
<span class="sd">    out_folder : str</span>
<span class="sd">        path to output directory</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; copy to &quot;</span> <span class="o">+</span> <span class="n">out_folder</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">replicaID</span> <span class="ow">in</span> <span class="n">replica_range</span><span class="p">:</span>
        <span class="n">out_cnfs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">replicaID</span><span class="p">:</span> <span class="n">bash</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">[</span><span class="n">replicaID</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">out_folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">[</span><span class="n">replicaID</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))})</span></div>


<div class="viewcode-block" id="_thread_worker_conv_trc"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management._thread_worker_conv_trc">[docs]</a><span class="k">def</span> <span class="nf">_thread_worker_conv_trc</span><span class="p">(</span><span class="n">job</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">replica_range</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                            <span class="n">trc_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                            <span class="n">in_topology_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">gromos_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">out_traj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                            <span class="n">fit_traj_to_mol</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="n">boundary_conditions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;_thread_worker_conv_trc</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    job : int</span>
<span class="sd">        rank of this thread</span>
<span class="sd">    replica_range : Iterable[int]</span>
<span class="sd">        list of replica IDs</span>
<span class="sd">    trc_files : List[str]</span>
<span class="sd">        list of trc files</span>
<span class="sd">    in_topology_path : str</span>
<span class="sd">        path to input topology file</span>
<span class="sd">    gromos_path : str</span>
<span class="sd">        path to gromos binaries</span>
<span class="sd">    out_traj : dict</span>
<span class="sd">    fit_traj_to_mol : int, optional</span>
<span class="sd">        default 1</span>
<span class="sd">    boundary_conditions : str, optional</span>
<span class="sd">        default &quot;r&quot;</span>
<span class="sd">    verbose: bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; RANGE</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">replica_range</span><span class="p">))</span>
    <span class="n">gromPP</span> <span class="o">=</span> <span class="n">gromosPP</span><span class="o">.</span><span class="n">GromosPP</span><span class="p">(</span><span class="n">gromos_path</span><span class="p">)</span>
    <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="kn">import</span> <span class="nn">mdtraj</span>
    <span class="n">start_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">replicaID</span> <span class="ow">in</span> <span class="n">replica_range</span><span class="p">:</span>
        <span class="n">trc_path</span> <span class="o">=</span> <span class="n">trc_files</span><span class="p">[</span><span class="n">replicaID</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">first</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;_job&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">),</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;convert_&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">trc_path</span><span class="p">))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">unarchived</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">use_trc</span> <span class="o">=</span> <span class="n">trc_path</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using trc:&quot;</span><span class="p">,</span> <span class="n">use_trc</span><span class="p">)</span>
        <span class="n">out_top_path</span> <span class="o">=</span> <span class="n">use_trc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.trc&quot;</span><span class="p">,</span> <span class="s2">&quot;_last.pdb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">out_traj_path</span> <span class="o">=</span> <span class="n">use_trc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.trc&quot;</span><span class="p">,</span> <span class="s2">&quot;.dcd&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">out_traj</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">replicaID</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">out_top_path</span><span class="p">,</span> <span class="s2">&quot;traj&quot;</span><span class="p">:</span> <span class="n">out_traj_path</span><span class="p">}})</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_top_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_traj_path</span><span class="p">)):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Found already the traj and its top!:&quot;</span> <span class="o">+</span> <span class="n">out_traj_path</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: Converting trc_path to -&gt; &quot;</span> <span class="o">+</span> <span class="n">use_trc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;trc&quot;</span><span class="p">,</span> <span class="s2">&quot;pdb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tar.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">pdb</span> <span class="o">=</span> <span class="n">gromPP</span><span class="o">.</span><span class="n">frameout</span><span class="p">(</span><span class="n">in_top_path</span><span class="o">=</span><span class="n">in_topology_path</span><span class="p">,</span> <span class="n">in_coord_path</span><span class="o">=</span><span class="n">use_trc</span><span class="p">,</span>
                              <span class="n">periodic_boundary_condition</span><span class="o">=</span><span class="n">boundary_conditions</span><span class="p">,</span>
                              <span class="n">gather</span><span class="o">=</span><span class="s2">&quot;cog&quot;</span><span class="p">,</span> <span class="n">out_file_format</span><span class="o">=</span><span class="s2">&quot;pdb&quot;</span><span class="p">,</span>
                              <span class="n">atomsfit</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">fit_traj_to_mol</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:a&quot;</span><span class="p">,</span> <span class="n">single_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">out_file_path</span><span class="o">=</span><span class="n">use_trc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;trc&quot;</span><span class="p">,</span> <span class="s2">&quot;pdb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;tar&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: loading pdb : &quot;</span> <span class="o">+</span> <span class="n">pdb</span><span class="p">)</span>
        <span class="n">traj</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">load_pdb</span><span class="p">(</span><span class="n">pdb</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: write out data to &quot;</span> <span class="o">+</span> <span class="n">use_trc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.trc&quot;</span><span class="p">,</span> <span class="s2">&quot;.dcd/.pdb&quot;</span><span class="p">))</span>
        <span class="n">traj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">out_traj_path</span><span class="p">)</span>
        <span class="n">traj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">out_top_path</span><span class="p">)</span>

        <span class="k">del</span> <span class="n">traj</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done writing out&quot;</span><span class="p">)</span>
        <span class="n">bash</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="n">pdb</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">unarchived</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clean unarchiving&quot;</span><span class="p">)</span>
            <span class="n">bash</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="n">use_trc</span><span class="p">)</span>
    <span class="n">bash</span><span class="o">.</span><span class="n">remove_folder</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">start_dir</span><span class="p">)</span></div>


<div class="viewcode-block" id="thread_worker_isolate_energies"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.thread_worker_isolate_energies">[docs]</a><span class="k">def</span> <span class="nf">thread_worker_isolate_energies</span><span class="p">(</span><span class="n">in_en_file_paths</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                   <span class="n">out_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                   <span class="n">properties</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                   <span class="n">replicas</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                                   <span class="n">in_ene_ana_lib</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                   <span class="n">gromosPP_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                   <span class="n">out_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                   <span class="n">tre_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                   <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">job</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;isolate_properties_from_tre</span>
<span class="sd">        This func uses Ene Ana from gromos to isolate potentials from out_tre Files</span>
<span class="sd">        in in_folder generated by reeds.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_en_file_paths : str</span>
<span class="sd">        path, in which the input tre_folders are situated.</span>
<span class="sd">    out_folder : str</span>
<span class="sd">         output folder, where to write the energy .csvs</span>
<span class="sd">    properties : List[str]</span>
<span class="sd">        potentials to isolate from the .out_tre Files</span>
<span class="sd">    replicas : List[int]</span>
<span class="sd">        list of replicas, that should be found</span>
<span class="sd">    in_ene_ana_lib : str</span>
<span class="sd">         path to the ene_ana lib, encoding the out_tre Files</span>
<span class="sd">    gromosPP_path : str</span>
<span class="sd">        path to the ene_ana lib, encoding the out_tre Files</span>
<span class="sd">    out_prefix : str, optional</span>
<span class="sd">    tre_prefix : str, optional</span>
<span class="sd">    time : float, optional</span>
<span class="sd">        start time (default None)</span>
<span class="sd">    dt : float, optional</span>
<span class="sd">        timestep (default None)</span>
<span class="sd">    job : int, optional</span>
<span class="sd">        rank of current job</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]</span>
<span class="sd">        return list of result Files.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gromos</span> <span class="o">=</span> <span class="n">gromosPP</span><span class="o">.</span><span class="n">GromosPP</span><span class="p">(</span><span class="n">gromosPP_path</span><span class="p">)</span>
    <span class="n">result_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;_job&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">),</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;ene_ana_&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">out_folder</span><span class="p">)</span>

    <span class="n">start_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

    <span class="c1"># get the potentials from each replica.tre*</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: working with job: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">replicas</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">replicaID</span> <span class="ow">in</span> <span class="n">replicas</span><span class="p">:</span>
        <span class="n">in_en_file_path</span> <span class="o">=</span> <span class="n">in_en_file_paths</span><span class="p">[</span><span class="n">replicaID</span><span class="p">]</span>

        <span class="n">out_suffix</span> <span class="o">=</span> <span class="s2">&quot;energies_s&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">replicaID</span><span class="p">)</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">out_folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">out_prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">out_suffix</span> <span class="o">+</span> <span class="s2">&quot;.dat&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CHECKING: &quot;</span> <span class="o">+</span> <span class="n">out_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_path</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">replicaID</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">in_en_file_path</span><span class="p">)</span>
            <span class="n">tmp_out</span> <span class="o">=</span> <span class="n">gromos</span><span class="o">.</span><span class="n">ene_ana</span><span class="p">(</span><span class="n">in_ene_ana_library_path</span><span class="o">=</span><span class="n">in_ene_ana_lib</span><span class="p">,</span> <span class="n">in_en_file_paths</span><span class="o">=</span><span class="n">in_en_file_path</span><span class="p">,</span>
                                     <span class="n">out_energy_folder_path</span><span class="o">=</span><span class="n">out_folder</span><span class="p">,</span>
                                     <span class="n">out_files_suffix</span><span class="o">=</span><span class="n">out_suffix</span><span class="p">,</span> <span class="n">out_files_prefix</span><span class="o">=</span><span class="n">out_prefix</span><span class="p">,</span>
                                     <span class="n">time</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="p">),</span>
                                     <span class="n">in_properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">single_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">result_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>
            <span class="n">bash</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="s2">&quot;/*&quot;</span><span class="p">)</span>  <span class="c1"># remove logs if succesfull</span>

    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">start_dir</span><span class="p">)</span>
    <span class="n">bash</span><span class="o">.</span><span class="n">remove_folder</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: DONE&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result_files</span></div>


<div class="viewcode-block" id="_thread_worker_delete"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management._thread_worker_delete">[docs]</a><span class="k">def</span> <span class="nf">_thread_worker_delete</span><span class="p">(</span><span class="n">job</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                          <span class="n">file_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                          <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;_thread_worker_delete</span>
<span class="sd">    delete files in list</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    job : int</span>
<span class="sd">        rank of current job</span>
<span class="sd">    file_paths : List[str]</span>
<span class="sd">        paths to files which should be deleted</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - rm: &quot;</span> <span class="o">+</span> <span class="n">file_path</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">bash</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="_thread_worker_compress"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management._thread_worker_compress">[docs]</a><span class="k">def</span> <span class="nf">_thread_worker_compress</span><span class="p">(</span><span class="n">job</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">in_file_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;_thread_worker_compress</span>
<span class="sd">    compress files in list</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    job : int</span>
<span class="sd">        rank of current job</span>
<span class="sd">    in_file_paths : List[str]</span>
<span class="sd">        paths to files which should be deleted</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">in_file_paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JOB&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - gz: &quot;</span> <span class="o">+</span> <span class="n">file_path</span><span class="p">)</span>
        <span class="n">bash</span><span class="o">.</span><span class="n">compress_gzip</span><span class="p">(</span><span class="n">in_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FILE FINDER</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="find_and_unarchive_tar_files"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.find_and_unarchive_tar_files">[docs]</a><span class="k">def</span> <span class="nf">find_and_unarchive_tar_files</span><span class="p">(</span><span class="n">trc_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;find_and_unarchive_tar_files</span>
<span class="sd">    find and untar/unzip archived files</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    trc_files : List[str]</span>
<span class="sd">        trajectory files to be untared</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># archive handling</span>
    <span class="n">archived_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;.tar&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;.gz&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;.tar.gz&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">),</span> <span class="n">trc_files</span><span class="p">))</span>
    <span class="n">not_archived_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;tar&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;.gz&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;.tar.gz&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">),</span> <span class="n">trc_files</span><span class="p">))</span>
    <span class="n">unarchived_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;archives: &quot;</span><span class="p">,</span> <span class="n">archived_files</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;narchives: &quot;</span><span class="p">,</span> <span class="n">not_archived_files</span><span class="p">)</span>

    <span class="c1"># untar files:</span>
    <span class="k">for</span> <span class="n">tared_file</span> <span class="ow">in</span> <span class="n">archived_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">not_archived_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">noAfile</span> <span class="ow">in</span> <span class="n">tared_file</span> <span class="k">for</span> <span class="n">noAfile</span> <span class="ow">in</span> <span class="n">not_archived_files</span><span class="p">])):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># print(&quot;Ungzip -&gt;\t&quot;, tared_file)</span>
                <span class="n">out_path</span> <span class="o">=</span> <span class="n">bash</span><span class="o">.</span><span class="n">compress_gzip</span><span class="p">(</span><span class="n">in_path</span><span class="o">=</span><span class="n">tared_file</span><span class="p">,</span>
                                              <span class="n">out_path</span><span class="o">=</span><span class="n">tared_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tar&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">extract</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># print(&quot;Failed gzip, trying tar&quot;)</span>
                <span class="n">out_path</span> <span class="o">=</span> <span class="n">bash</span><span class="o">.</span><span class="n">extract_tar</span><span class="p">(</span><span class="n">in_path</span><span class="o">=</span><span class="n">tared_file</span><span class="p">,</span>
                                            <span class="n">out_path</span><span class="o">=</span><span class="n">tared_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tar&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                                            <span class="n">gunzip_compression</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># fix for stupid taring!    #todo: remove part</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">any</span><span class="p">([</span><span class="s2">&quot;cluster&quot;</span> <span class="o">==</span> <span class="n">xfile</span> <span class="k">for</span> <span class="n">xfile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">tared_file</span><span class="p">))])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                    <span class="n">out_path</span><span class="p">)):</span>
                <span class="n">nfound</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">cpath</span><span class="p">,</span> <span class="n">tdir</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">tared_file</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/cluster&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">tared_file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tar&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">files</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FOUND PATH: &quot;</span><span class="p">,</span>
                                            <span class="n">cpath</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">tared_file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tar&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                                <span class="s2">&quot;.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                        <span class="n">wrong_path</span> <span class="o">=</span> <span class="n">cpath</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">tared_file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tar&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="n">out_file</span> <span class="o">=</span> <span class="n">bash</span><span class="o">.</span><span class="n">move_file</span><span class="p">(</span><span class="n">wrong_path</span><span class="p">,</span> <span class="n">tared_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tar&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                        <span class="n">unarchived_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span>
                        <span class="n">nfound</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nfound</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;could not find untarred file!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unarchived_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>

                <span class="c1"># raise Exception(&quot;this tar needs special treatment as it is in cluster/yadda/yadda/fun.trc&quot;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">([</span><span class="n">noAfile</span> <span class="k">for</span> <span class="n">noAfile</span> <span class="ow">in</span> <span class="n">not_archived_files</span> <span class="k">if</span> <span class="p">(</span><span class="n">noAfile</span> <span class="ow">in</span> <span class="n">tared_file</span><span class="p">)])</span>
    <span class="n">new_files</span> <span class="o">=</span> <span class="n">not_archived_files</span>
    <span class="n">new_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">unarchived_files</span><span class="p">)</span>

    <span class="n">use_tre_file_paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">new_files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">use_tre_file_paths</span><span class="p">,</span> <span class="n">unarchived_files</span></div>


<div class="viewcode-block" id="gather_simulation_replica_file_paths"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.gather_simulation_replica_file_paths">[docs]</a><span class="k">def</span> <span class="nf">gather_simulation_replica_file_paths</span><span class="p">(</span><span class="n">in_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                         <span class="n">replicas</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                         <span class="n">filePrefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                         <span class="n">fileSuffixes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.tre&quot;</span><span class="p">,</span> <span class="s2">&quot;.tre.tar.gz&quot;</span><span class="p">],</span>
                                         <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                         <span class="n">finalNumberingSort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;gather_simulation_replica_file_paths</span>

<span class="sd">    Finds all trajectory paths in a simulation folder and sorts them by replica.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_folder : str</span>
<span class="sd">        folder, containing the files</span>
<span class="sd">    replicas : int</span>
<span class="sd">        Number of replicas</span>
<span class="sd">    filePrefix : str, optional</span>
<span class="sd">        str prefix the desired files (default &quot;&quot;)</span>
<span class="sd">    fileSuffixes : str, optional</span>
<span class="sd">        str suffix of the desired files (default [&quot;.tre&quot;, &quot;.tre.tar.gz&quot;])</span>
<span class="sd">    finalNumberingSort : bool, optional</span>
<span class="sd">        default False</span>
<span class="sd">    verbose :   bool</span>
<span class="sd">        toggle verbosity</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dict[int, List[str]]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">fileSuffixes</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="n">fileSuffixes</span> <span class="o">=</span> <span class="p">[</span><span class="n">fileSuffixes</span><span class="p">]</span>

    <span class="c1"># browse folders</span>
    <span class="c1">##init statewise dic</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">replica</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">replicas</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">files</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">replica</span><span class="p">:</span> <span class="p">[]})</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SEARCH PATTERN: &quot;</span> <span class="o">+</span> <span class="n">filePrefix</span> <span class="o">+</span> <span class="s2">&quot; + * +&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileSuffixes</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">in_folder</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dirname</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;eq&quot;</span><span class="p">)):</span>
            <span class="k">continue</span>
        <span class="c1"># check actual in_dir for fle pattern</span>
        <span class="n">tmp_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filenames</span> <span class="k">if</span>
                     <span class="p">(</span><span class="n">filePrefix</span> <span class="ow">in</span> <span class="n">file</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="n">suffix</span> <span class="ow">in</span> <span class="n">file</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">fileSuffixes</span><span class="p">]))]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">replicas</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">grom_file_prefix</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">dirname</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tmp_files</span> <span class="k">if</span>
                                           <span class="p">(</span><span class="nb">any</span><span class="p">([</span><span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">file</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">fileSuffixes</span><span class="p">]))])</span>
                <span class="n">files</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">grom_file_prefix</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;walking to in_dir: &quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dirname</span><span class="p">),</span> <span class="s2">&quot;found: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_files</span><span class="p">))</span>

    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">finalNumberingSort</span><span class="p">):</span>
        <span class="c1"># final_cleanup</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">files</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">foundFiles:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">y</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">files</span><span class="p">[</span><span class="n">x</span><span class="p">]]))</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;could not find any file with the prefix: &quot;</span> <span class="o">+</span> <span class="n">filePrefix</span> <span class="o">+</span> <span class="s2">&quot; in folder : </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">in_folder</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">files</span></div>


<div class="viewcode-block" id="gather_simulation_file_paths"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.gather_simulation_file_paths">[docs]</a><span class="k">def</span> <span class="nf">gather_simulation_file_paths</span><span class="p">(</span><span class="n">in_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filePrefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                 <span class="n">fileSuffixes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.tre&quot;</span><span class="p">,</span> <span class="s2">&quot;.tre.tar.gz&quot;</span><span class="p">],</span>
                                 <span class="n">files_per_folder</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;gather_simulation_file_paths</span>
<span class="sd">    find energy trajectory files in a folder</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_folder : str</span>
<span class="sd">        directory where the files should be searched</span>
<span class="sd">    filePrefix : str, optional</span>
<span class="sd">        prefix of the file name pattern (default &quot;&quot;)</span>
<span class="sd">    fileSuffixes : Union[str, List[str]]</span>
<span class="sd">        suffixes of the file name pattern (default [&quot;.tre&quot;, &quot;.tre.tar.gz&quot;])</span>
<span class="sd">    files_per_folder : int, optional</span>
<span class="sd">        number of files per folder (default 1)</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]  </span>
<span class="sd">        list of sorted files</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">fileSuffixes</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="n">fileSuffixes</span> <span class="o">=</span> <span class="p">[</span><span class="n">fileSuffixes</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SEARCH PATTERN: &quot;</span> <span class="o">+</span> <span class="n">filePrefix</span> <span class="o">+</span> <span class="s2">&quot; + * +&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileSuffixes</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">in_folder</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dirname</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;eq&quot;</span><span class="p">)):</span>
            <span class="k">continue</span>
        <span class="c1"># check actual in_dir for fle pattern</span>
        <span class="n">tmp_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filenames</span> <span class="k">if</span>
                     <span class="p">(</span><span class="n">filePrefix</span> <span class="ow">in</span> <span class="n">file</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="n">suffix</span> <span class="ow">in</span> <span class="n">file</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">fileSuffixes</span><span class="p">]))]</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_files</span><span class="p">)</span> <span class="o">==</span> <span class="n">files_per_folder</span><span class="p">):</span>
            <span class="n">files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dirname</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">tmp_files</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;walking to in_dir: &quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dirname</span><span class="p">),</span> <span class="s2">&quot;found: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_files</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">isdecimal</span><span class="p">())][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
        <span class="n">sorted_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">files</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Files are not all enumerated! no file sorting.&quot;</span><span class="p">)</span>
        <span class="n">sorted_files</span> <span class="o">=</span> <span class="n">files</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">foundFiles:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sorted_files</span><span class="p">))</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;could not find any file with the prefix: &quot;</span> <span class="o">+</span> <span class="n">filePrefix</span> <span class="o">+</span> <span class="s2">&quot; in folder : </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">in_folder</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sorted_files</span></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ENERGY FILE FUNCTIONS</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="extract_eds_energies_from_tre"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.extract_eds_energies_from_tre">[docs]</a><span class="k">def</span> <span class="nf">extract_eds_energies_from_tre</span><span class="p">(</span><span class="n">in_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                  <span class="n">in_ene_ana_lib_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                  <span class="n">num_replicas</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                  <span class="n">in_gromosPP_bin_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">out_file_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;eds_energies&quot;</span><span class="p">,</span>
                                  <span class="n">additional_properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;solvtemp2&quot;</span><span class="p">,</span> <span class="s2">&quot;totdisres&quot;</span><span class="p">),</span>
                                  <span class="n">n_processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                  <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;extract_eds_energies_from_tre</span>
<span class="sd">    This function extracts the EDS energies from a Gromos energy trajectory file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_dir : str</span>
<span class="sd">        directory where the tre files are located</span>
<span class="sd">    out_dir : str</span>
<span class="sd">        directory where the concatenated energy file should be stored</span>
<span class="sd">    in_ene_ana_lib_path : str</span>
<span class="sd">        path to the ene_ana library</span>
<span class="sd">    num_replicas : int</span>
<span class="sd">        number of replicas in the system</span>
<span class="sd">    num_states : int</span>
<span class="sd">        number of states in the system</span>
<span class="sd">    in_gromosPP_bin_dir : str, optional</span>
<span class="sd">        path to directory with gromosPP executable (default None)</span>
<span class="sd">    out_file_prefix : str, optional</span>
<span class="sd">        file name prefix for output file (default &quot;eds_energies&quot;)</span>
<span class="sd">    additional_properties : Union[Tuple[str], List[str]], optional</span>
<span class="sd">        additional properties given to ene_ana (default (&quot;solvtemp2&quot;, &quot;totdisres&quot;))</span>
<span class="sd">    n_processes : int, optional</span>
<span class="sd">        number of parallel processes to use (default 1)</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Iterable[str]</span>
<span class="sd">        list of energy output files</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c1"># gather potentials</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">additional_properties</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;eR&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;e&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_states</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># isolate potentials</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Isolate ene_ana:&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>
        <span class="n">distribute_jobs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">in_dir</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">,</span> <span class="n">n_processes</span><span class="p">),</span> <span class="n">in_ene_ana_lib_path</span><span class="p">,</span>
                            <span class="n">in_gromosPP_bin_dir</span><span class="p">,</span> <span class="n">out_file_prefix</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)]</span>
        <span class="n">p_ene_ana</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap_async</span><span class="p">(</span><span class="n">thread_worker_isolate_energies</span><span class="p">,</span> <span class="n">distribute_jobs</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">out_files</span> <span class="o">=</span> <span class="n">thread_worker_isolate_energies</span><span class="p">(</span><span class="n">in_en_file_paths</span><span class="o">=</span><span class="n">in_dir</span><span class="p">,</span>
                                                   <span class="n">out_folder</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span>
                                                   <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                                                   <span class="n">out_prefix</span><span class="o">=</span><span class="n">out_file_prefix</span><span class="p">,</span>
                                                   <span class="n">in_ene_ana_lib</span><span class="o">=</span><span class="n">in_ene_ana_lib_path</span><span class="p">,</span>
                                                   <span class="n">gromosPP_path</span><span class="o">=</span><span class="n">in_gromosPP_bin_dir</span><span class="p">,</span>
                                                   <span class="n">replicas</span><span class="o">=</span><span class="p">[</span><span class="n">num_replicas</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">out_files</span></div>


<div class="viewcode-block" id="find_header"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.find_header">[docs]</a><span class="k">def</span> <span class="nf">find_header</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;find_header</span>
<span class="sd">    this function counts the lines of the header (i.e. how many lines there are</span>
<span class="sd">    until the first line with doesn&#39;t start with a &#39;#&#39; is encountered)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        file path</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        number of lines belonging to the header</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">comment_lines</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)):</span>
                <span class="n">comment_lines</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">comment_lines</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">comment_lines</span></div>


<div class="viewcode-block" id="parse_csv_energy_trajectory"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.parse_csv_energy_trajectory">[docs]</a><span class="k">def</span> <span class="nf">parse_csv_energy_trajectory</span><span class="p">(</span><span class="n">in_ene_traj_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;parse_csv_energy_trajectory</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_ene_traj_path : str</span>
<span class="sd">        path to input file</span>

<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        return a pandas data frame containing all energies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deal with: &quot;</span><span class="p">,</span> <span class="n">in_ene_traj_path</span><span class="p">)</span>
    <span class="n">ene_traj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">in_ene_traj_path</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">find_header</span><span class="p">(</span><span class="n">in_ene_traj_path</span><span class="p">),</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ene_traj</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ene_traj</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">ene_traj</span><span class="p">,</span> <span class="s2">&quot;in_path&quot;</span><span class="p">,</span> <span class="n">in_ene_traj_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ene_traj</span></div>


<div class="viewcode-block" id="parse_csv_energy_trajectories"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.parse_csv_energy_trajectories">[docs]</a><span class="k">def</span> <span class="nf">parse_csv_energy_trajectories</span><span class="p">(</span><span class="n">in_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                  <span class="n">ene_trajs_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                  <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;parse_csv_energy_trajectories</span>
<span class="sd">    searches a directory and loads energy eds csvs as pandas dataframes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_folder : str</span>
<span class="sd">        folder with energy_traj - csvs</span>
<span class="sd">    ene_trajs_prefix : str</span>
<span class="sd">        prefix name</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[pd.DataFrame]</span>
<span class="sd">        return a list with pandas data frames containing all energy infos.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SEARCH: &quot;</span><span class="p">,</span> <span class="n">in_folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">ene_trajs_prefix</span> <span class="o">+</span> <span class="s2">&quot;*.dat&quot;</span><span class="p">)</span>
    <span class="n">in_ene_traj_paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">in_folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">ene_trajs_prefix</span> <span class="o">+</span> <span class="s2">&quot;*.dat&quot;</span><span class="p">),</span>
                               <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)))</span>
    <span class="n">ene_trajs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FOUND: &quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">in_ene_traj_paths</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">in_ene_traj_path</span> <span class="ow">in</span> <span class="n">in_ene_traj_paths</span><span class="p">:</span>
        <span class="n">ene_traj</span> <span class="o">=</span> <span class="n">parse_csv_energy_trajectory</span><span class="p">(</span><span class="n">in_ene_traj_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;csv columns: </span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ene_traj</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="c1"># note: the previous version created problems for filenames which contained periods</span>
        <span class="c1">#setattr(ene_traj, &quot;s&quot;, ((ene_traj.in_path.split(&quot;.&quot;))[0]).split(&quot;_&quot;)[-1])</span>
        <span class="c1">#setattr(ene_traj, &quot;replicaID&quot;, int(((ene_traj.in_path.split(&quot;.&quot;))[0]).split(&quot;_&quot;)[-1].replace(&quot;s&quot;, &quot;&quot;)))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">ene_traj</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="p">((</span><span class="n">ene_traj</span><span class="o">.</span><span class="n">in_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">ene_traj</span><span class="p">,</span> <span class="s2">&quot;replicaID&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(((</span><span class="n">ene_traj</span><span class="o">.</span><span class="n">in_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)))</span>
        <span class="n">ene_trajs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ene_traj</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ene_trajs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;could not find any energy_trajectory in: &quot;</span><span class="p">,</span> <span class="n">in_folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">ene_trajs_prefix</span> <span class="o">+</span> <span class="s2">&quot;*.dat&quot;</span><span class="p">)</span>

    <span class="n">ene_trajs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ene_trajs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">ene_trajs</span></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    concatenation wrapper</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="project_concatenation"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.project_concatenation">[docs]</a><span class="k">def</span> <span class="nf">project_concatenation</span><span class="p">(</span><span class="n">in_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">in_topology_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">in_imd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                          <span class="n">control_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
                          <span class="n">out_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">in_ene_ana_lib_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">out_file_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
                          <span class="n">fit_traj_to_mol</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">starting_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                          <span class="n">include_water_in_trc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">additional_properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;solvtemp2&quot;</span><span class="p">,</span> <span class="s2">&quot;totdisres&quot;</span><span class="p">),</span>
                          <span class="n">n_processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">gromosPP_bin_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">nofinal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">boundary_conditions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r cog&quot;</span><span class="p">,</span>
                          <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;project_concatenation</span>
<span class="sd">    wrapper for the concatenation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_folder : str</span>
<span class="sd">        input directory</span>
<span class="sd">    in_topology_path : str</span>
<span class="sd">        path to the topology file</span>
<span class="sd">    in_imd : str</span>
<span class="sd">        path to the imd file</span>
<span class="sd">    num_replicas : int</span>
<span class="sd">        number of replicas</span>
<span class="sd">    control_dict : Dict[str, bool]</span>
<span class="sd">        control dict to specify what should be executed or skipped</span>
<span class="sd">    out_folder : str</span>
<span class="sd">        output directory</span>
<span class="sd">    in_ene_ana_lib_path : str</span>
<span class="sd">        path to ene_ana lib file</span>
<span class="sd">    out_file_prefix : str, optional</span>
<span class="sd">        prefix for the output file names (default &quot;test&quot;)</span>
<span class="sd">    fit_traj_to_mol : int, optional</span>
<span class="sd">        parameter for gromos++ frameout @atomsfit (default 1)</span>
<span class="sd">    starting_time : float, optional</span>
<span class="sd">        start time of trajectory (default 0)</span>
<span class="sd">    include_water_in_trc : bool, optional</span>
<span class="sd">        should water molecules be included in trajectory file? (default True)</span>
<span class="sd">    additional_properties : Union[Tuple[str],List[str]], optional</span>
<span class="sd">        additional properties to give to gromos++ ene_ana (default (&quot;solvtemp2&quot;, &quot;totdisres&quot;))</span>
<span class="sd">    n_processes : int, optional</span>
<span class="sd">        number of parallel processes to use (default 1)</span>
<span class="sd">    gromosPP_bin_dir : str, optional</span>
<span class="sd">        path to gromos++ executable (default None)</span>
<span class="sd">    nofinal : bool, optional</span>
<span class="sd">        (default False)</span>
<span class="sd">    boundary_condition : str, optional</span>
<span class="sd">        boundary condition for gromos++ frameout (default &quot;r cog&quot;)</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        dict containg the out_folder, cnfs, repdat, tres, trcs and dcds</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;reading imd file: &quot;</span> <span class="o">+</span> <span class="n">in_imd</span><span class="p">)</span>

    <span class="n">imd_file</span> <span class="o">=</span> <span class="n">imd</span><span class="o">.</span><span class="n">Imd</span><span class="p">(</span><span class="n">in_imd</span><span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">imd_file</span><span class="o">.</span><span class="n">STEP</span><span class="o">.</span><span class="n">DT</span><span class="p">)</span>
    <span class="n">dt_trc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">imd_file</span><span class="o">.</span><span class="n">WRITETRAJ</span><span class="o">.</span><span class="n">NTWX</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">dt_tre</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">imd_file</span><span class="o">.</span><span class="n">WRITETRAJ</span><span class="o">.</span><span class="n">NTWE</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">out_folder</span> <span class="o">+</span> <span class="s2">&quot;/tmp_file&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)):</span>
        <span class="n">bash</span><span class="o">.</span><span class="n">make_folder</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>

    <span class="n">out_cnfs</span> <span class="o">=</span> <span class="n">out_tres</span> <span class="o">=</span> <span class="n">out_trcs</span> <span class="o">=</span> <span class="n">out_dcd</span> <span class="o">=</span> <span class="n">out_repdat</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p_conv</span> <span class="o">=</span> <span class="n">p_cnf</span> <span class="o">=</span> <span class="n">p_repdat</span> <span class="o">=</span> <span class="n">p_trc</span> <span class="o">=</span> <span class="n">p_tre</span> <span class="o">=</span> <span class="n">p_ene_ana</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">submitted_trc_job</span> <span class="o">=</span> <span class="n">submitted_tre_job</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">control_dict</span><span class="p">[</span><span class="s2">&quot;cp_cnf&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Start cnfs&quot;</span><span class="p">)</span>
        <span class="c1"># find all cnf files in this project</span>
        <span class="n">sim_dir_cnfs</span> <span class="o">=</span> <span class="n">gather_simulation_replica_file_paths</span><span class="p">(</span><span class="n">in_folder</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">,</span> <span class="n">filePrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fileSuffixes</span><span class="o">=</span><span class="s2">&quot;.cnf&quot;</span><span class="p">,</span>
                                                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">finalNumberingSort</span><span class="o">=</span><span class="n">nofinal</span><span class="p">)</span>

        <span class="c1"># do parallel</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">out_cnfs</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
            <span class="n">distribute</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="n">out_cnfs</span><span class="p">,</span> <span class="n">sim_dir_cnfs</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim_dir_cnfs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span><span class="p">),</span> <span class="n">out_folder</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="c1"># _async</span>
            <span class="n">p_cnf</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_cnfs</span><span class="p">,</span> <span class="n">distribute</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_cnfs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_thread_worker_cnfs</span><span class="p">(</span><span class="n">job</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_cnfs</span><span class="o">=</span><span class="n">out_cnfs</span><span class="p">,</span> <span class="n">in_cnfs</span><span class="o">=</span><span class="n">sim_dir_cnfs</span><span class="p">,</span>
                                <span class="n">replica_range</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sim_dir_cnfs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">out_folder</span><span class="o">=</span><span class="n">out_folder</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Out cnfs: &quot;</span><span class="p">,</span> <span class="n">out_cnfs</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">control_dict</span><span class="p">[</span><span class="s2">&quot;cat_trc&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Start Trc Cat&quot;</span><span class="p">)</span>
        <span class="c1"># find all trc files in this project</span>
        <span class="n">trc_files</span> <span class="o">=</span> <span class="n">gather_simulation_replica_file_paths</span><span class="p">(</span><span class="n">in_folder</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">,</span> <span class="n">filePrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                                         <span class="n">fileSuffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;.trc&quot;</span><span class="p">,</span> <span class="s2">&quot;.trc.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;.trc.tar.gz&quot;</span><span class="p">],</span>
                                                         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                         <span class="n">finalNumberingSort</span><span class="o">=</span><span class="n">nofinal</span><span class="p">)</span>

        <span class="n">out_prefix</span> <span class="o">=</span> <span class="n">out_folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">out_file_prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>

        <span class="c1"># concat all files to a single .trc</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># parallel</span>
            <span class="n">submitted_trc_job</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;going parallel: n_processes - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_processes</span><span class="p">))</span>
            <span class="n">out_trcs</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
            <span class="n">distributed_jobs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trc_files</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span><span class="p">),</span> <span class="n">trc_files</span><span class="p">,</span> <span class="n">out_prefix</span><span class="p">,</span> <span class="n">in_topology_path</span><span class="p">,</span> <span class="n">out_trcs</span><span class="p">,</span>
                 <span class="n">dt_trc</span><span class="p">,</span> <span class="n">starting_time</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">include_water_in_trc</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="c1"># _async</span>
            <span class="n">p_trc</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_cat_trc</span><span class="p">,</span> <span class="n">distributed_jobs</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_trcs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_thread_worker_cat_trc</span><span class="p">(</span><span class="n">job</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">topology_path</span><span class="o">=</span><span class="n">in_topology_path</span><span class="p">,</span> <span class="n">replicaID_range</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">trc_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                   <span class="n">trc_files</span><span class="o">=</span><span class="n">trc_files</span><span class="p">,</span> <span class="n">out_prefix</span><span class="o">=</span><span class="n">out_prefix</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt_trc</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">starting_time</span><span class="p">,</span>
                                   <span class="n">out_trcs</span><span class="o">=</span><span class="n">out_trcs</span><span class="p">,</span>
                                   <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">boundary_conditions</span><span class="o">=</span><span class="n">boundary_conditions</span><span class="p">,</span>
                                   <span class="n">include_all</span><span class="o">=</span><span class="n">include_water_in_trc</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">control_dict</span><span class="p">[</span><span class="s2">&quot;cat_tre&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Start Tre Cat&quot;</span><span class="p">)</span>

        <span class="c1"># find all trc files in this project</span>
        <span class="n">tre_files</span> <span class="o">=</span> <span class="n">gather_simulation_replica_file_paths</span><span class="p">(</span><span class="n">in_folder</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">,</span> <span class="n">filePrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                                         <span class="n">fileSuffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;.tre&quot;</span><span class="p">,</span> <span class="s2">&quot;.tre.tar.gz&quot;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                         <span class="n">finalNumberingSort</span><span class="o">=</span><span class="n">nofinal</span><span class="p">)</span>

        <span class="n">out_prefix</span> <span class="o">=</span> <span class="n">out_folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">out_file_prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="c1"># concat all files to a single .trc</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;going parallel: n_processes - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_processes</span><span class="p">),</span> <span class="s2">&quot; for &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tre_files</span><span class="p">))</span>
            <span class="n">submitted_tre_job</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">out_tres</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
            <span class="n">distributed_jobs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tre_files</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span><span class="p">),</span> <span class="n">tre_files</span><span class="p">,</span> <span class="n">out_prefix</span><span class="p">,</span> <span class="n">out_tres</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>
            <span class="n">p_tre</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_cat_tre</span><span class="p">,</span> <span class="n">distributed_jobs</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_tres</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_thread_worker_cat_tre</span><span class="p">(</span><span class="n">job</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">replicaID_range</span><span class="o">=</span><span class="n">tre_files</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">tre_files</span><span class="o">=</span><span class="n">tre_files</span><span class="p">,</span> <span class="n">out_prefix</span><span class="o">=</span><span class="n">out_prefix</span><span class="p">,</span>
                                   <span class="n">out_tres</span><span class="o">=</span><span class="n">out_tres</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">control_dict</span><span class="p">[</span><span class="s2">&quot;ene_ana&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Start ene ana&quot;</span><span class="p">)</span>

        <span class="c1"># wait for async job creating the trcs.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">submitted_tre_job</span><span class="p">):</span>
            <span class="n">p_tre</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="c1"># gather potentials</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">additional_properties</span><span class="p">)</span>
        <span class="c1"># find all trc files in this project</span>
        <span class="n">tre_files</span> <span class="o">=</span> <span class="n">gather_simulation_replica_file_paths</span><span class="p">(</span><span class="n">in_folder</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">,</span> <span class="n">filePrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                                         <span class="n">fileSuffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;.tre&quot;</span><span class="p">,</span> <span class="s2">&quot;.tre.gz&quot;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                         <span class="n">finalNumberingSort</span><span class="o">=</span><span class="n">nofinal</span><span class="p">)</span>  <span class="c1"># &quot;.tre.tar.gz&quot;</span>
        <span class="c1"># isolate potentials</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Isolate ene_ana:&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>
            <span class="n">distribute_jobs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">out_folder</span><span class="p">,</span> <span class="n">out_folder</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">tre_files</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">n</span><span class="p">::</span><span class="n">n_processes</span><span class="p">],</span> <span class="n">in_ene_ana_lib_path</span><span class="p">,</span>
                 <span class="n">gromosPP_bin_dir</span><span class="p">,</span> <span class="n">out_file_prefix</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dt_tre</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)]</span>
            <span class="n">p_ene_ana</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap_async</span><span class="p">(</span><span class="n">thread_worker_isolate_energies</span><span class="p">,</span> <span class="n">distribute_jobs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thread_worker_isolate_energies</span><span class="p">(</span><span class="n">in_en_file_paths</span><span class="o">=</span><span class="n">tre_files</span><span class="p">,</span> <span class="n">out_folder</span><span class="o">=</span><span class="n">out_folder</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                                           <span class="n">out_prefix</span><span class="o">=</span><span class="n">out_file_prefix</span><span class="p">,</span>
                                           <span class="n">in_ene_ana_lib</span><span class="o">=</span><span class="n">in_ene_ana_lib_path</span><span class="p">,</span>
                                           <span class="n">gromosPP_path</span><span class="o">=</span><span class="n">gromosPP_bin_dir</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt_tre</span><span class="p">,</span>
                                           <span class="n">replicas</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">tre_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">control_dict</span><span class="p">[</span><span class="s2">&quot;convert_trcs&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Start Trc Conversion&quot;</span><span class="p">)</span>
        <span class="c1"># wait for async job creating the trcs.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">submitted_trc_job</span><span class="p">):</span>
            <span class="n">p_trc</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="c1"># get files:</span>
        <span class="n">final_trc_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">out_folder</span> <span class="o">+</span> <span class="s2">&quot;/*.trc*&quot;</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">out_dcd</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
            <span class="n">distributed_jobs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">,</span> <span class="n">n_processes</span><span class="p">),</span> <span class="n">final_trc_files</span><span class="p">,</span> <span class="n">in_topology_path</span><span class="p">,</span> <span class="n">gromosPP_bin_dir</span><span class="p">,</span> <span class="n">out_dcd</span><span class="p">,</span>
                 <span class="n">fit_traj_to_mol</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span> <span class="k">for</span>
                <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)]</span>
            <span class="n">p_conv</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap_async</span><span class="p">(</span><span class="n">_thread_worker_conv_trc</span><span class="p">,</span> <span class="n">distributed_jobs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_dcd</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_thread_worker_conv_trc</span><span class="p">(</span><span class="n">job</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">replica_range</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">num_replicas</span><span class="p">),</span> <span class="n">trc_files</span><span class="o">=</span><span class="n">final_trc_files</span><span class="p">,</span>
                                    <span class="n">in_topology_path</span><span class="o">=</span><span class="n">in_topology_path</span><span class="p">,</span>
                                    <span class="n">gromos_path</span><span class="o">=</span><span class="n">gromosPP_bin_dir</span><span class="p">,</span> <span class="n">out_traj</span><span class="o">=</span><span class="n">out_dcd</span><span class="p">,</span> <span class="n">fit_traj_to_mol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                    <span class="n">boundary_conditions</span><span class="o">=</span><span class="n">boundary_conditions</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># wait for the jobs to finish</span>
        <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="n">p_conv</span> <span class="ow">or</span> <span class="n">p_conv</span><span class="o">.</span><span class="n">wait</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">p_cnf</span> <span class="ow">or</span> <span class="n">p_cnf</span><span class="o">.</span><span class="n">wait</span><span class="p">())</span> <span class="ow">and</span>
                <span class="p">(</span><span class="ow">not</span> <span class="n">p_repdat</span> <span class="ow">or</span> <span class="n">p_repdat</span><span class="o">.</span><span class="n">wait</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">p_trc</span> <span class="ow">or</span> <span class="n">p_trc</span><span class="o">.</span><span class="n">wait</span><span class="p">())</span> <span class="ow">and</span>
                <span class="p">(</span><span class="ow">not</span> <span class="n">p_tre</span> <span class="ow">or</span> <span class="n">p_tre</span><span class="o">.</span><span class="n">wait</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">p_ene_ana</span> <span class="ow">or</span> <span class="n">p_ene_ana</span><span class="o">.</span><span class="n">wait</span><span class="p">())):</span>
            <span class="k">raise</span> <span class="ne">ChildProcessError</span><span class="p">(</span><span class="s2">&quot;A process failed! &quot;</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;out_folder&quot;</span><span class="p">:</span> <span class="n">out_folder</span><span class="p">,</span> <span class="s2">&quot;cnfs&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">out_cnfs</span><span class="p">),</span> <span class="s2">&quot;repdat&quot;</span><span class="p">:</span> <span class="n">out_repdat</span><span class="p">,</span> <span class="s2">&quot;tres&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">out_tres</span><span class="p">),</span>
                    <span class="s2">&quot;trcs&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">out_trcs</span><span class="p">),</span> <span class="s2">&quot;dcds&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">out_dcd</span><span class="p">)}</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;out_folder&quot;</span><span class="p">:</span> <span class="n">out_folder</span><span class="p">,</span> <span class="s2">&quot;cnfs&quot;</span><span class="p">:</span> <span class="n">out_cnfs</span><span class="p">,</span> <span class="s2">&quot;repdat&quot;</span><span class="p">:</span> <span class="n">out_repdat</span><span class="p">,</span> <span class="s2">&quot;tres&quot;</span><span class="p">:</span> <span class="n">out_tres</span><span class="p">,</span>
                    <span class="s2">&quot;trcs&quot;</span><span class="p">:</span> <span class="n">out_trcs</span><span class="p">,</span> <span class="s2">&quot;dcds&quot;</span><span class="p">:</span> <span class="n">out_dcd</span><span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;all jobs finished&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_dict</span></div>


<div class="viewcode-block" id="reeds_project_concatenation"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.reeds_project_concatenation">[docs]</a><span class="k">def</span> <span class="nf">reeds_project_concatenation</span><span class="p">(</span><span class="n">in_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">in_topology_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">in_imd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">num_replicas</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="n">control_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
                                <span class="n">out_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">in_ene_ana_lib_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">repdat_file_out_path</span><span class="p">:</span> <span class="nb">str</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">out_file_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
                                <span class="n">fit_traj_to_mol</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">starting_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="n">include_water_in_trc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">additional_properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;solvtemp2&quot;</span><span class="p">,</span> <span class="s2">&quot;totdisres&quot;</span><span class="p">),</span>
                                <span class="n">n_processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">gromosPP_bin_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">nofinal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">boundary_conditions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r cog&quot;</span><span class="p">,</span>
                                <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;reeds_project_concatenation </span>
<span class="sd">    wrapper for the concatenation for REEDS</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_folder : str</span>
<span class="sd">        input directory</span>
<span class="sd">    in_topology_path : str</span>
<span class="sd">        path to the topology file</span>
<span class="sd">    in_imd : str</span>
<span class="sd">        path to the imd file</span>
<span class="sd">    num_replicas : int</span>
<span class="sd">        number of replicas</span>
<span class="sd">    control_dict : Dict[str, bool]</span>
<span class="sd">        control dict to specify what should be executed or skipped</span>
<span class="sd">    out_folder : str</span>
<span class="sd">        output directory</span>
<span class="sd">    in_ene_ana_lib_path : str</span>
<span class="sd">        path to ene_ana lib file</span>
<span class="sd">    out_file_prefix : str, optional</span>
<span class="sd">        prefix for the output file names (default &quot;test&quot;)</span>
<span class="sd">    fit_traj_to_mol : int, optional</span>
<span class="sd">        parameter for gromos++ frameout @atomsfit (default 1)</span>
<span class="sd">    starting_time : float, optional</span>
<span class="sd">        start time of trajectory (default 0)</span>
<span class="sd">    include_water_in_trc : bool, optional</span>
<span class="sd">        should water molecules be included in trajectory file? (default True)</span>
<span class="sd">    additional_properties : Union[Tuple[str],List[str]], optional</span>
<span class="sd">        additional properties to give to gromos++ ene_ana (default (&quot;solvtemp2&quot;, &quot;totdisres&quot;))</span>
<span class="sd">    n_processes : int, optional</span>
<span class="sd">        number of parallel processes to use (default 1)</span>
<span class="sd">    gromosPP_bin_dir : str, optional</span>
<span class="sd">        path to gromos++ executable (default None)</span>
<span class="sd">    nofinal : bool, optional</span>
<span class="sd">        (default False)</span>
<span class="sd">    boundary_condition : str, optional</span>
<span class="sd">        boundary condition for gromos++ frameout (default &quot;r cog&quot;)</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        dict containg the out_folder, cnfs, repdat, tres, trcs and dcds</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;reading imd file: &quot;</span> <span class="o">+</span> <span class="n">in_imd</span><span class="p">)</span>
    <span class="n">imd_file</span> <span class="o">=</span> <span class="n">imd</span><span class="o">.</span><span class="n">Imd</span><span class="p">(</span><span class="n">in_imd</span><span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">imd_file</span><span class="o">.</span><span class="n">STEP</span><span class="o">.</span><span class="n">DT</span><span class="p">)</span>
    <span class="n">dt_trc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">imd_file</span><span class="o">.</span><span class="n">WRITETRAJ</span><span class="o">.</span><span class="n">NTWX</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">dt_tre</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">imd_file</span><span class="o">.</span><span class="n">WRITETRAJ</span><span class="o">.</span><span class="n">NTWE</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">num_states</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">imd_file</span><span class="o">.</span><span class="n">REPLICA_EDS</span><span class="o">.</span><span class="n">NUMSTATES</span><span class="p">)</span>

    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">out_folder</span> <span class="o">+</span> <span class="s2">&quot;/tmp_file&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)):</span>
        <span class="n">bash</span><span class="o">.</span><span class="n">make_folder</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>

    <span class="n">out_cnfs</span> <span class="o">=</span> <span class="n">out_tres</span> <span class="o">=</span> <span class="n">out_trcs</span> <span class="o">=</span> <span class="n">out_dcd</span> <span class="o">=</span> <span class="n">out_repdat</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p_conv</span> <span class="o">=</span> <span class="n">p_cnf</span> <span class="o">=</span> <span class="n">p_repdat</span> <span class="o">=</span> <span class="n">p_trc</span> <span class="o">=</span> <span class="n">p_tre</span> <span class="o">=</span> <span class="n">p_ene_ana</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">submitted_trc_job</span> <span class="o">=</span> <span class="n">submitted_tre_job</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">control_dict</span><span class="p">[</span><span class="s2">&quot;cp_cnf&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Start cnfs&quot;</span><span class="p">)</span>
        <span class="c1"># find all cnf files in this project</span>
        <span class="n">sim_dir_cnfs</span> <span class="o">=</span> <span class="n">gather_simulation_replica_file_paths</span><span class="p">(</span><span class="n">in_folder</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">,</span> <span class="n">filePrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fileSuffixes</span><span class="o">=</span><span class="s2">&quot;.cnf&quot;</span><span class="p">,</span>
                                                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">finalNumberingSort</span><span class="o">=</span><span class="n">nofinal</span><span class="p">)</span>

        <span class="c1"># do parallel</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">out_cnfs</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
            <span class="n">distribute</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="n">out_cnfs</span><span class="p">,</span> <span class="n">sim_dir_cnfs</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim_dir_cnfs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span><span class="p">),</span> <span class="n">out_folder</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="c1"># _async</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>
            <span class="n">p_cnf</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_cnfs</span><span class="p">,</span> <span class="n">distribute</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_cnfs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_thread_worker_cnfs</span><span class="p">(</span><span class="n">job</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_cnfs</span><span class="o">=</span><span class="n">out_cnfs</span><span class="p">,</span> <span class="n">in_cnfs</span><span class="o">=</span><span class="n">sim_dir_cnfs</span><span class="p">,</span>
                                <span class="n">replica_range</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sim_dir_cnfs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">out_folder</span><span class="o">=</span><span class="n">out_folder</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Out cnfs: &quot;</span><span class="p">,</span> <span class="n">out_cnfs</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">control_dict</span><span class="p">[</span><span class="s2">&quot;cat_trc&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Start Trc Cat&quot;</span><span class="p">)</span>
        <span class="c1"># find all trc files in this project</span>
        <span class="n">trc_files</span> <span class="o">=</span> <span class="n">gather_simulation_replica_file_paths</span><span class="p">(</span><span class="n">in_folder</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">,</span> <span class="n">filePrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                                         <span class="n">fileSuffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;.trc&quot;</span><span class="p">,</span> <span class="s2">&quot;.trc.gz&quot;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                         <span class="n">finalNumberingSort</span><span class="o">=</span><span class="n">nofinal</span><span class="p">)</span>  <span class="c1"># ,&quot;.trc.tar.gz&quot;</span>

        <span class="c1"># trc_files=helper_function_change_compression_safe_incomplete_files(trc_files, in_topology_path=in_topology_path, tmp_dir=tmp_dir)</span>

        <span class="n">out_prefix</span> <span class="o">=</span> <span class="n">out_folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">out_file_prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>

        <span class="c1"># concat all files to a single .trc</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># parallel</span>
            <span class="n">submitted_trc_job</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;going parallel: n_processes - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_processes</span><span class="p">))</span>
            <span class="n">out_trcs</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
            <span class="n">distributed_jobs</span> <span class="o">=</span> <span class="p">[(</span>
                <span class="n">n</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trc_files</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span><span class="p">),</span> <span class="n">trc_files</span><span class="p">,</span> <span class="n">out_prefix</span><span class="p">,</span> <span class="n">in_topology_path</span><span class="p">,</span> <span class="n">out_trcs</span><span class="p">,</span>
                <span class="n">dt_trc</span><span class="p">,</span> <span class="n">starting_time</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">boundary_conditions</span><span class="p">,</span> <span class="n">include_water_in_trc</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span>
                <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>
            <span class="n">p_trc</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_cat_trc</span><span class="p">,</span> <span class="n">distributed_jobs</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_trcs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_thread_worker_cat_trc</span><span class="p">(</span><span class="n">job</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">topology_path</span><span class="o">=</span><span class="n">in_topology_path</span><span class="p">,</span> <span class="n">replicaID_range</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">trc_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                   <span class="n">trc_files</span><span class="o">=</span><span class="n">trc_files</span><span class="p">,</span> <span class="n">out_prefix</span><span class="o">=</span><span class="n">out_prefix</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt_trc</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">starting_time</span><span class="p">,</span>
                                   <span class="n">out_trcs</span><span class="o">=</span><span class="n">out_trcs</span><span class="p">,</span>
                                   <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">boundary_conditions</span><span class="o">=</span><span class="n">boundary_conditions</span><span class="p">,</span>
                                   <span class="n">include_all</span><span class="o">=</span><span class="n">include_water_in_trc</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">control_dict</span><span class="p">[</span><span class="s2">&quot;cat_tre&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Start Tre Cat&quot;</span><span class="p">)</span>

        <span class="c1"># find all trc files in this project</span>
        <span class="n">tre_files</span> <span class="o">=</span> <span class="n">gather_simulation_replica_file_paths</span><span class="p">(</span><span class="n">in_folder</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">,</span> <span class="n">filePrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                                         <span class="n">fileSuffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;.tre&quot;</span><span class="p">,</span> <span class="s2">&quot;.tre.gz&quot;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                         <span class="n">finalNumberingSort</span><span class="o">=</span><span class="n">nofinal</span><span class="p">)</span>  <span class="c1"># &quot;.tre.tar.gz&quot;</span>

        <span class="c1"># tre_files=helper_function_change_compression_safe_incomplete_files(tre_files, in_topology_path=in_topology_path, tmp_dir=tmp_dir)</span>

        <span class="n">out_prefix</span> <span class="o">=</span> <span class="n">out_folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">out_file_prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="c1"># concat all files to a single .trc</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;going parallel: n_processes - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_processes</span><span class="p">),</span> <span class="s2">&quot; for &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tre_files</span><span class="p">))</span>
            <span class="n">submitted_tre_job</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">out_tres</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
            <span class="n">distributed_jobs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tre_files</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span><span class="p">),</span> <span class="n">tre_files</span><span class="p">,</span> <span class="n">out_prefix</span><span class="p">,</span> <span class="n">out_tres</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_processes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>
            <span class="n">p_tre</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_cat_tre</span><span class="p">,</span> <span class="n">distributed_jobs</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_tres</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_thread_worker_cat_tre</span><span class="p">(</span><span class="n">job</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">replicaID_range</span><span class="o">=</span><span class="n">tre_files</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">tre_files</span><span class="o">=</span><span class="n">tre_files</span><span class="p">,</span> <span class="n">out_prefix</span><span class="o">=</span><span class="n">out_prefix</span><span class="p">,</span>
                                   <span class="n">out_tres</span><span class="o">=</span><span class="n">out_tres</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">control_dict</span><span class="p">[</span><span class="s2">&quot;cat_repdat&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Start Cat_repdat&quot;</span><span class="p">)</span>

        <span class="c1"># browse folders</span>
        <span class="n">repdat_file_paths</span> <span class="o">=</span> <span class="n">gather_simulation_file_paths</span><span class="p">(</span><span class="n">in_folder</span><span class="p">,</span> <span class="n">filePrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fileSuffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;repdat.dat&quot;</span><span class="p">],</span>
                                                         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">):</span>  <span class="c1"># submit to pool for async execution</span>
            <span class="n">distributed_jobs</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">repdat_file_out_path</span><span class="p">,</span> <span class="n">repdat_file_paths</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>
            <span class="n">p_repdat</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">thread_worker_concat_repdat</span><span class="p">,</span> <span class="n">distributed_jobs</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thread_worker_concat_repdat</span><span class="p">(</span><span class="n">job</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">repdat_file_out_path</span><span class="o">=</span><span class="n">repdat_file_out_path</span><span class="p">,</span>
                                        <span class="n">repdat_file_paths</span><span class="o">=</span><span class="n">repdat_file_paths</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">out_repdat</span> <span class="o">=</span> <span class="n">repdat_file_out_path</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">control_dict</span><span class="p">[</span><span class="s2">&quot;ene_ana&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Start ene ana&quot;</span><span class="p">)</span>

        <span class="c1"># wait for async job creating the trcs.</span>
        <span class="c1"># if (submitted_tre_job):</span>
        <span class="c1"># p_tre.wait()</span>

        <span class="c1"># gather potentials</span>
        <span class="c1"># find all trc files in this project</span>
        <span class="n">tre_files</span> <span class="o">=</span> <span class="n">gather_simulation_replica_file_paths</span><span class="p">(</span><span class="n">in_folder</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">,</span> <span class="n">filePrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                                         <span class="n">fileSuffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;.tre&quot;</span><span class="p">,</span> <span class="s2">&quot;.tre.gz&quot;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                         <span class="n">finalNumberingSort</span><span class="o">=</span><span class="n">nofinal</span><span class="p">)</span>  <span class="c1"># &quot;.tre.tar.gz&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">tre_files</span><span class="p">)</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">additional_properties</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;eR&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;e&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_states</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="c1"># isolate potentials</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Isolate ene_ana:&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>
            <span class="n">distribute_jobs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">tre_files</span><span class="p">,</span> <span class="n">out_folder</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">tre_files</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">n</span><span class="p">::</span><span class="n">n_processes</span><span class="p">],</span> <span class="n">in_ene_ana_lib_path</span><span class="p">,</span>
                 <span class="n">gromosPP_bin_dir</span><span class="p">,</span> <span class="n">out_file_prefix</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dt_tre</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)]</span>
            <span class="n">p_ene_ana</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">thread_worker_isolate_energies</span><span class="p">,</span> <span class="n">distribute_jobs</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_files</span> <span class="o">=</span> <span class="n">thread_worker_isolate_energies</span><span class="p">(</span><span class="n">in_en_file_paths</span><span class="o">=</span><span class="n">tre_files</span><span class="p">,</span> <span class="n">out_folder</span><span class="o">=</span><span class="n">out_folder</span><span class="p">,</span>
                                                       <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                                                       <span class="n">out_prefix</span><span class="o">=</span><span class="n">out_file_prefix</span><span class="p">,</span>
                                                       <span class="n">in_ene_ana_lib</span><span class="o">=</span><span class="n">in_ene_ana_lib_path</span><span class="p">,</span>
                                                       <span class="n">gromosPP_path</span><span class="o">=</span><span class="n">gromosPP_bin_dir</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt_tre</span><span class="p">,</span>
                                                       <span class="n">replicas</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">tre_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">control_dict</span><span class="p">[</span><span class="s2">&quot;convert_trcs&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Start Trc Conversion&quot;</span><span class="p">)</span>
        <span class="c1"># wait for async job creating the trcs.</span>
        <span class="c1"># if (submitted_trc_job):</span>
        <span class="c1">#    p_trc.wait()</span>

        <span class="c1"># get files:</span>
        <span class="n">final_trc_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">out_folder</span> <span class="o">+</span> <span class="s2">&quot;/*.trc*&quot;</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">out_dcd</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>

            <span class="n">distributed_jobs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">num_replicas</span><span class="p">,</span> <span class="n">n_processes</span><span class="p">),</span> <span class="n">final_trc_files</span><span class="p">,</span> <span class="n">in_topology_path</span><span class="p">,</span> <span class="n">gromosPP_bin_dir</span><span class="p">,</span> <span class="n">out_dcd</span><span class="p">,</span>
                 <span class="n">fit_traj_to_mol</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span> <span class="k">for</span>
                <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)]</span>
            <span class="n">p_conv</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_conv_trc</span><span class="p">,</span> <span class="n">distributed_jobs</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_dcd</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_thread_worker_conv_trc</span><span class="p">(</span><span class="n">job</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">replica_range</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">num_replicas</span><span class="p">),</span> <span class="n">trc_files</span><span class="o">=</span><span class="n">final_trc_files</span><span class="p">,</span>
                                    <span class="n">in_topology_path</span><span class="o">=</span><span class="n">in_topology_path</span><span class="p">,</span>
                                    <span class="n">gromos_path</span><span class="o">=</span><span class="n">gromosPP_bin_dir</span><span class="p">,</span> <span class="n">out_traj</span><span class="o">=</span><span class="n">out_dcd</span><span class="p">,</span> <span class="n">fit_traj_to_mol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #wait for the jobs to finish</span>
<span class="sd">        if ((not p_conv or p_conv.wait()) and (not p_cnf or p_cnf.wait()) and</span>
<span class="sd">                (not p_repdat or p_repdat.wait()) and (not p_trc or p_trc.wait()) and</span>
<span class="sd">                (not p_tre or p_tre.wait()) and (not p_ene_ana or p_ene_ana.wait())):</span>
<span class="sd">            raise ChildProcessError(&quot;A process failed! &quot;)</span>

<span class="sd">        p.close()</span>
<span class="sd">        p.join()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out_cnfs</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">out_cnfs</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">out_cnfs</span><span class="p">)</span>
        <span class="n">out_tres</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">out_tres</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">out_tres</span><span class="p">)</span>
        <span class="n">out_trcs</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">out_trcs</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">out_trcs</span><span class="p">)</span>
        <span class="n">out_dcd</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">out_dcd</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">out_dcd</span><span class="p">)</span>

        <span class="n">manager</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

    <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;out_folder&quot;</span><span class="p">:</span> <span class="n">out_folder</span><span class="p">,</span> <span class="s2">&quot;cnfs&quot;</span><span class="p">:</span> <span class="n">out_cnfs</span><span class="p">,</span> <span class="s2">&quot;repdat&quot;</span><span class="p">:</span> <span class="n">out_repdat</span><span class="p">,</span> <span class="s2">&quot;tres&quot;</span><span class="p">:</span> <span class="n">out_tres</span><span class="p">,</span>
                <span class="s2">&quot;trcs&quot;</span><span class="p">:</span> <span class="n">out_trcs</span><span class="p">,</span> <span class="s2">&quot;dcds&quot;</span><span class="p">:</span> <span class="n">out_dcd</span><span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;all jobs finished&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_dict</span></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    COMPRESS FUNCTION</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="clean_up_dirs"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.clean_up_dirs">[docs]</a><span class="k">def</span> <span class="nf">clean_up_dirs</span><span class="p">(</span><span class="n">root_dirs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                  <span class="n">run_dry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="n">delete_stuff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="n">n_processors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;clean_up_dirs</span>
<span class="sd">    clean up a directory by removing and compressing files/subdirectories</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    root_dirs : List[str]</span>
<span class="sd">        directories to be cleaned</span>
<span class="sd">    run_dry : bool, optional</span>
<span class="sd">        test run? (default False)</span>
<span class="sd">    delete_stuff : bool, optional</span>
<span class="sd">        should simulation.tar.gz be deleted? (default False)</span>
<span class="sd">    n_processors : int, optional</span>
<span class="sd">        number of parallel processes to use (default 1)</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        None    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">delete_stuff</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;DELETE_STUFF is true -&gt; I will delete simulation.tar.gz folders if there is an ana folder and all .logs&quot;</span><span class="p">)</span>

    <span class="n">tasks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rm&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;tar&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">root_dirs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">root_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">root_dirs</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">root_dir</span> <span class="ow">in</span> <span class="n">root_dirs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">root_dir</span><span class="p">):</span>
            <span class="n">trx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.trc&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.tre&quot;</span><span class="p">))]</span>
            <span class="n">delete_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span>
                            <span class="p">(</span><span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;simulation.tar.gz&quot;</span> <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.log&quot;</span><span class="p">)</span> <span class="ow">or</span>
                             <span class="p">(</span><span class="s2">&quot;_repout_&quot;</span> <span class="ow">in</span> <span class="n">file</span> <span class="ow">and</span> <span class="s2">&quot;.dat&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span>
                             <span class="p">(</span><span class="s2">&quot;elm4&quot;</span> <span class="ow">in</span> <span class="n">path</span> <span class="ow">and</span> <span class="s2">&quot;lsf.o&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span>
                             <span class="p">(</span><span class="s2">&quot;elm4&quot;</span> <span class="ow">in</span> <span class="n">path</span> <span class="ow">and</span> <span class="s2">&quot;emin_box_&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span>
                             <span class="p">(</span><span class="s2">&quot;elm4&quot;</span> <span class="ow">in</span> <span class="n">path</span> <span class="ow">and</span> <span class="s2">&quot;.sh.err&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span>
                             <span class="p">(</span><span class="s2">&quot;elm4&quot;</span> <span class="ow">in</span> <span class="n">path</span> <span class="ow">and</span> <span class="s2">&quot;.sh.out&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span>
                             <span class="p">(</span><span class="s2">&quot;elm4&quot;</span> <span class="ow">in</span> <span class="n">path</span> <span class="ow">and</span> <span class="s2">&quot;.omd&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span>
                             <span class="p">(</span><span class="s2">&quot;elm2&quot;</span> <span class="ow">in</span> <span class="n">path</span> <span class="ow">and</span> <span class="s2">&quot;.trs&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span>
                             <span class="p">(</span><span class="s2">&quot;slave&quot;</span> <span class="ow">in</span> <span class="n">file</span> <span class="ow">and</span> <span class="s2">&quot;.out&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span>
                             <span class="p">)]</span>

            <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;rm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">delete_files</span><span class="p">)</span>
            <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;tar&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">trx_files</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FOUND FOLLOWING TASKS&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remove: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;rm&quot;</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tar: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;tar&quot;</span><span class="p">]))</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">run_dry</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_processors</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processors</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">delete_stuff</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;rm&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Do rm: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">distribute</span> <span class="o">=</span> <span class="p">[(</span><span class="n">job</span><span class="p">,</span> <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;rm&quot;</span><span class="p">][</span><span class="n">job</span><span class="p">::</span><span class="n">n_processors</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_processors</span><span class="p">)]</span>
                <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_delete</span><span class="p">,</span> <span class="n">distribute</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Do Tar: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">distribute</span> <span class="o">=</span> <span class="p">[(</span><span class="n">job</span><span class="p">,</span> <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;tar&quot;</span><span class="p">][</span><span class="n">job</span><span class="p">::</span><span class="n">n_processors</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_processors</span><span class="p">)]</span>
            <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_compress</span><span class="p">,</span> <span class="n">distribute</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">delete_stuff</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Do rm: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">remove_file</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;rm&quot;</span><span class="p">]:</span>
                    <span class="n">bash</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="n">remove_file</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Do Tar: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">tar_file</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;tar&quot;</span><span class="p">]:</span>
                <span class="n">bash</span><span class="o">.</span><span class="n">compress_gzip</span><span class="p">(</span><span class="n">in_path</span><span class="o">=</span><span class="n">tar_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DONE!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This was a dry run! so I did not do a thing. :)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="clean_up_euler_dirs"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.clean_up_euler_dirs">[docs]</a><span class="k">def</span> <span class="nf">clean_up_euler_dirs</span><span class="p">(</span><span class="n">root_dirs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                        <span class="n">run_dry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">delete_stuff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">n_processors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;clean_up_euler_dirs</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    root_dirs : List[str]</span>
<span class="sd">        directories to be cleaned</span>
<span class="sd">    run_dry : bool, optional</span>
<span class="sd">        test run? (default False)</span>
<span class="sd">    delete_stuff : bool, optional</span>
<span class="sd">        should simulation.tar.gz be deleted? (default False)</span>
<span class="sd">    n_processors : int, optional</span>
<span class="sd">        number of parallel processes to use (default 1)</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        None  </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">delete_stuff</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;DELETE_STUFF is true -&gt; I will delete simulation.tar.gz folders if there is an ana folder and all .logs&quot;</span><span class="p">)</span>

    <span class="n">tasks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rm&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;tar&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">root_dirs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">root_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">root_dirs</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">root_dir</span> <span class="ow">in</span> <span class="n">root_dirs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">root_dir</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;scratch&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;simulation&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">):</span>
                <span class="n">trx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.trc&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.tre&quot;</span><span class="p">))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.trc&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.tre&quot;</span><span class="p">))]</span>
                <span class="n">delete_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span>
                                <span class="p">(</span><span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;simulation.tar.gz&quot;</span> <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.log&quot;</span><span class="p">)</span> <span class="ow">or</span>
                                 <span class="p">(</span><span class="s2">&quot;_repout_&quot;</span> <span class="ow">in</span> <span class="n">file</span> <span class="ow">and</span> <span class="s2">&quot;.dat&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span>
                                 <span class="p">(</span><span class="s2">&quot;.sh.err&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;.sh.out&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span>
                                 <span class="p">(</span><span class="s2">&quot;.trs&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;stat.out&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span>
                                 <span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;eds_energies&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span>
                                     <span class="s2">&quot;.dat&quot;</span><span class="p">))</span>
                                 <span class="p">)]</span>
            <span class="c1">#                                                                    (&quot;elm4&quot; in path and &quot;.omd&quot; in file) or</span>
            <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;rm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">delete_files</span><span class="p">)</span>
            <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;tar&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">trx_files</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FOUND FOLLOWING TASKS&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remove: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;rm&quot;</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tar: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;tar&quot;</span><span class="p">]))</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">run_dry</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_processors</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processors</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">delete_stuff</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;rm&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Do rm: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">distribute</span> <span class="o">=</span> <span class="p">[(</span><span class="n">job</span><span class="p">,</span> <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;rm&quot;</span><span class="p">][</span><span class="n">job</span><span class="p">::</span><span class="n">n_processors</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_processors</span><span class="p">)]</span>
                <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_delete</span><span class="p">,</span> <span class="n">distribute</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Do Tar: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">distribute</span> <span class="o">=</span> <span class="p">[(</span><span class="n">job</span><span class="p">,</span> <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;tar&quot;</span><span class="p">][</span><span class="n">job</span><span class="p">::</span><span class="n">n_processors</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_processors</span><span class="p">)]</span>
            <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_compress</span><span class="p">,</span> <span class="n">distribute</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">delete_stuff</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Do rm: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">remove_file</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;rm&quot;</span><span class="p">]:</span>
                    <span class="n">bash</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="n">remove_file</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Do Tar: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">tar_file</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">[</span><span class="s2">&quot;tar&quot;</span><span class="p">]:</span>
                <span class="n">bash</span><span class="o">.</span><span class="n">compress_tar</span><span class="p">(</span><span class="n">in_path</span><span class="o">=</span><span class="n">tar_file</span><span class="p">,</span> <span class="n">gunzip_compression</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">remove_in_file_afterwards</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DONE!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This was a dry run! so I did not do a thing. :)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="compress_folder"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.compress_folder">[docs]</a><span class="k">def</span> <span class="nf">compress_folder</span><span class="p">(</span><span class="n">in_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;compress_folder</span>
<span class="sd">    compress a folder</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_paths : list</span>
<span class="sd">        list of file paths</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        list of output file paths</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compress data folder?</span>
    <span class="n">out_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">in_paths</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">in_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">in_paths</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">in_paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
            <span class="n">archive_path</span> <span class="o">=</span> <span class="n">bash</span><span class="o">.</span><span class="n">compress_tar</span><span class="p">(</span><span class="n">in_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;.tar&quot;</span><span class="p">,</span> <span class="n">gunzip_compression</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                             <span class="n">remove_in_dir_afterwards</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">out_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">archive_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;File Path: &quot;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot; was not found!&quot;</span><span class="p">)</span>
    <span class="c1"># add</span>
    <span class="k">return</span> <span class="n">out_paths</span></div>


<div class="viewcode-block" id="compress_files"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.compress_files">[docs]</a><span class="k">def</span> <span class="nf">compress_files</span><span class="p">(</span><span class="n">in_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                   <span class="n">n_processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;compress_files</span>
<span class="sd">    compress a list of files</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_paths : List[str]</span>
<span class="sd">        input file paths</span>
<span class="sd">    n_processes: int, optional</span>
<span class="sd">        number of parallel processes to use (default 1)</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]</span>
<span class="sd">        outpaths</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">in_paths</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">in_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">in_paths</span><span class="p">]</span>
    <span class="n">out_paths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># check:</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">in_paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
            <span class="n">archive_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;.gz&quot;</span>
            <span class="n">out_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">archive_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;File Path: &quot;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot; was not found!&quot;</span><span class="p">)</span>

    <span class="c1"># do:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gen Gzips:&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n_processes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">in_paths</span><span class="p">:</span>
            <span class="n">bash</span><span class="o">.</span><span class="n">compress_gzip</span><span class="p">(</span><span class="n">in_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;.gz&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># do parallel</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)</span>
        <span class="n">distribute</span> <span class="o">=</span> <span class="p">[(</span><span class="n">job</span><span class="p">,</span> <span class="n">in_paths</span><span class="p">[</span><span class="n">job</span><span class="p">::</span><span class="n">n_processes</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_processes</span><span class="p">)]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">_thread_worker_compress</span><span class="p">,</span> <span class="n">distribute</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">out_paths</span></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coordinate File Mappings </span>
<span class="sd">    These functions can be used to map the cnf coordinates most smoothly to a new s-distribution.</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="adapt_cnfs_to_new_sDistribution"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.adapt_cnfs_to_new_sDistribution">[docs]</a><span class="k">def</span> <span class="nf">adapt_cnfs_to_new_sDistribution</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                    <span class="n">in_new_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                    <span class="n">in_cnf_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                    <span class="n">out_cnf_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                    <span class="n">cnf_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;REEDS_EOFF_run&quot;</span><span class="p">,</span>
                                    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;adapt_cnfs_to_new_sDistribution</span>
<span class="sd">    this function should map coordinate files, belonging to an old s-distribution in an optimal way to a new s-distribution.</span>
<span class="sd">    Therefore it removes or adds coordinate files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_old_svals : list</span>
<span class="sd">        list of old s-values</span>
<span class="sd">    in_new_svals : list</span>
<span class="sd">        list of new s-values</span>
<span class="sd">    in_cnf_files : List[str]</span>
<span class="sd">        list of old cnf files</span>
<span class="sd">    out_cnf_dir : str</span>
<span class="sd">        path to output directory for cnf files</span>
<span class="sd">    cnf_prefix : str, optional</span>
<span class="sd">        prefix for output cnf files (default &quot;REEDS_EOFF_run&quot;)</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        list of output cnf files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># INPUT PARSING</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">in_cnf_files</span><span class="p">,</span> <span class="n">List</span><span class="p">)):</span>
        <span class="n">in_cnfs</span> <span class="o">=</span> <span class="n">in_cnf_files</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Got empty list!: &quot;</span> <span class="o">+</span> <span class="n">in_cnf_files</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please give either correct in_cnf_files!&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;got different number of old svals and cnfs - no mapping possible!:</span><span class="se">\n\t</span><span class="s2"> svals: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span>
                                 <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2"> in_cnfs: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">in_cnfs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.cnf&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))))</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input CNFs&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">()</span>

    <span class="n">s1_repetitions</span> <span class="o">=</span> <span class="n">in_old_svals</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># DECIDE ON HOW TO MAP</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;too less &quot;</span><span class="p">)</span>
        <span class="n">out_cnfs</span> <span class="o">=</span> <span class="n">reduce_cnf_eoff</span><span class="p">(</span><span class="n">in_opt_struct_cnf_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_num_states</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                   <span class="n">in_current_sim_cnf_dir</span><span class="o">=</span><span class="n">in_cnfs</span><span class="p">,</span> <span class="n">in_old_svals</span><span class="o">=</span><span class="n">in_old_svals</span><span class="p">,</span> <span class="n">in_new_svals</span><span class="o">=</span><span class="n">in_new_svals</span><span class="p">,</span>
                                   <span class="n">out_next_cnfs_dir</span><span class="o">=</span><span class="n">out_cnf_dir</span><span class="p">,</span> <span class="n">run_prefix</span><span class="o">=</span><span class="n">cnf_prefix</span><span class="p">,</span> <span class="n">s1_repetitions</span><span class="o">=</span><span class="n">s1_repetitions</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;too many&quot;</span><span class="p">)</span>
        <span class="n">out_cnfs</span> <span class="o">=</span> <span class="n">map_cnfs_to_svalues</span><span class="p">(</span><span class="n">in_old_cnf_files</span><span class="o">=</span><span class="n">in_cnfs</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="n">out_cnf_dir</span><span class="p">,</span> <span class="n">in_old_svals</span><span class="o">=</span><span class="n">in_old_svals</span><span class="p">,</span>
                                       <span class="n">in_new_svals</span><span class="o">=</span><span class="n">in_new_svals</span><span class="p">,</span>
                                       <span class="n">cnf_prefix</span><span class="o">=</span><span class="n">cnf_prefix</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of CNF is fine!&quot;</span><span class="p">)</span>
        <span class="n">out_cnfs</span> <span class="o">=</span> <span class="n">in_cnfs</span>

    <span class="k">return</span> <span class="n">out_cnfs</span></div>


<div class="viewcode-block" id="adapt_cnfs_Eoff_to_Sopt"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.adapt_cnfs_Eoff_to_Sopt">[docs]</a><span class="k">def</span> <span class="nf">adapt_cnfs_Eoff_to_Sopt</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                            <span class="n">in_new_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                            <span class="n">in_cnf_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                            <span class="n">out_cnf_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">in_opt_struct_cnf_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">in_num_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">out_cnf_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;REEDS_run&quot;</span><span class="p">,</span>
                            <span class="n">LRTO_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;adapt_cnfs_Eoff_to_Sopt</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_old_svals : list</span>
<span class="sd">        list of old s-values</span>
<span class="sd">    in_new_svals : list</span>
<span class="sd">        list of new s-values</span>
<span class="sd">    in_cnf_files : List[str]</span>
<span class="sd">        list of old cnf files</span>
<span class="sd">    out_cnf_dir : str</span>
<span class="sd">        path to output directory for cnf files</span>
<span class="sd">    in_opt_struct_cnf_dir : str</span>
<span class="sd">        input path to where cnf files are located</span>
<span class="sd">    in_num_states : int</span>
<span class="sd">        number of states</span>
<span class="sd">    out_cnf_prefix : str, optional</span>
<span class="sd">        prefix for output cnf files (default &quot;REEDS_run&quot;)</span>
<span class="sd">    LRTO_mode : bool, optional</span>
<span class="sd">        add cnfs in LRTO-like fashion (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]</span>
<span class="sd">        list of output cnf files</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># INPUT PARSING</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">in_cnf_files</span><span class="p">,</span> <span class="n">List</span><span class="p">)):</span>
        <span class="n">in_cnfs</span> <span class="o">=</span> <span class="n">in_cnf_files</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Got empty list!: &quot;</span> <span class="o">+</span> <span class="n">in_cnf_files</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">in_opt_struct_cnf_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="n">in_cnfs</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">in_opt_struct_cnf_dir</span> <span class="o">+</span> <span class="s2">&quot;/*cnf&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Could not find any cnf in: &quot;</span> <span class="o">+</span> <span class="n">in_opt_struct_cnf_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please give either in_cnf_dir or in_cnf_files!&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;got different number of old svals and cnfs - no mapping possible!:</span><span class="se">\n\t</span><span class="s2"> svals: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span>
                                 <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2"> in_cnfs: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">in_cnfs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">in_cnfs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.cnf&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))))</span>

    <span class="c1"># DECIDE ON HOW TO MAP</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;too less &quot;</span><span class="p">)</span>
        <span class="n">out_cnfs</span> <span class="o">=</span> <span class="n">reduce_cnf_eoff</span><span class="p">(</span><span class="n">in_opt_struct_cnf_dir</span><span class="o">=</span><span class="n">in_opt_struct_cnf_dir</span><span class="p">,</span> <span class="n">in_num_states</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                   <span class="n">in_current_sim_cnf_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">in_cnf_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">in_old_svals</span><span class="o">=</span><span class="n">in_old_svals</span><span class="p">,</span>
                                   <span class="n">in_new_svals</span><span class="o">=</span><span class="n">in_new_svals</span><span class="p">,</span>
                                   <span class="n">out_next_cnfs_dir</span><span class="o">=</span><span class="n">out_cnf_dir</span><span class="p">,</span> <span class="n">run_prefix</span><span class="o">=</span><span class="n">out_cnf_prefix</span><span class="p">,</span>
                                   <span class="n">s1_repetitions</span><span class="o">=</span><span class="n">in_num_states</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">LRTO_mode</span><span class="p">):</span>
            <span class="n">out_cnfs</span> <span class="o">=</span> <span class="n">add_cnf_sopt_LRTOlike</span><span class="p">(</span><span class="n">in_dir</span><span class="o">=</span><span class="n">in_opt_struct_cnf_dir</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="n">out_cnf_dir</span><span class="p">,</span>
                                             <span class="n">in_old_svals</span><span class="o">=</span><span class="n">in_old_svals</span><span class="p">,</span> <span class="n">in_new_svals</span><span class="o">=</span><span class="n">in_new_svals</span><span class="p">,</span>
                                             <span class="n">cnf_prefix</span><span class="o">=</span><span class="n">out_cnf_prefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_cnfs</span> <span class="o">=</span> <span class="n">map_cnfs_to_svalues</span><span class="p">(</span><span class="n">in_old_cnf_files</span><span class="o">=</span><span class="n">in_cnfs</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="n">out_cnf_dir</span><span class="p">,</span> <span class="n">in_old_svals</span><span class="o">=</span><span class="n">in_old_svals</span><span class="p">,</span>
                                           <span class="n">in_new_svals</span><span class="o">=</span><span class="n">in_new_svals</span><span class="p">,</span>
                                           <span class="n">cnf_prefix</span><span class="o">=</span><span class="n">out_cnf_prefix</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of CNF is fine!&quot;</span><span class="p">)</span>
        <span class="n">out_cnfs</span> <span class="o">=</span> <span class="n">in_cnfs</span>

    <span class="k">return</span> <span class="n">out_cnfs</span></div>


<div class="viewcode-block" id="map_cnfs_to_svalues"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.map_cnfs_to_svalues">[docs]</a><span class="k">def</span> <span class="nf">map_cnfs_to_svalues</span><span class="p">(</span><span class="n">in_old_cnf_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                        <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">in_old_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                        <span class="n">in_new_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                        <span class="n">cnf_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span>
                        <span class="n">replica_add_scheme</span><span class="p">:</span> <span class="n">add_scheme</span> <span class="o">=</span> <span class="n">add_scheme</span><span class="o">.</span><span class="n">from_bothSides</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;map_cnfs_to_svalues</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_old_cnf_files : List[str]</span>
<span class="sd">        path to old cnf files</span>
<span class="sd">    out_dir : str</span>
<span class="sd">        path to output directory</span>
<span class="sd">    in_old_svals : list</span>
<span class="sd">        list of old s-values</span>
<span class="sd">    in_new_svals : list</span>
<span class="sd">        list of new s-values</span>
<span class="sd">    cnf_prefix : str, optional</span>
<span class="sd">        prefix for output cnf files (default &quot;run&quot;)</span>
<span class="sd">    replica_add_scheme : add_scheme, optional</span>
<span class="sd">        enum for addition scheme from class adding_Scheme_new_Replicas (default from_bothSides)</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (Default True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]</span>
<span class="sd">        list of new cnf files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">replica_add_scheme</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Please provide only one adding scheme for adding the new replicas.&quot;</span><span class="p">)</span>

    <span class="n">new_cnf_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">in_old_svals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">in_old_svals</span><span class="p">)))</span>
    <span class="n">in_new_svals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">in_new_svals</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;): &quot;</span><span class="p">,</span> <span class="n">in_new_svals</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;old(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;): &quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;s value number difference (offfset): &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">))</span>

    <span class="n">out_prefix</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">cnf_prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">in_cnfs: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">in_old_cnf_files</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;out_folder: &quot;</span> <span class="o">+</span> <span class="n">out_dir</span><span class="p">)</span>

    <span class="n">added_svals</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">identify_closest_svalue</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">,</span> <span class="n">in_old_svals</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">relocate_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ==&gt;add replicas at positions :&quot;</span><span class="p">,</span> <span class="n">added_svals</span><span class="p">)</span>

    <span class="c1"># add cnfs if needed?</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Adding cnf files?&quot;</span><span class="p">)</span>

    <span class="c1"># mapping cnf to svals</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_old_cnf_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)):</span>  <span class="c1"># error check</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">&quot;There were more cnf files found than old_svalues! - This means that the coordinate files may not sequentially belong to the svals!</span><span class="se">\n</span><span class="s2"> old_svals: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">in_old_svals</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> cnfs: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">in_old_cnf_files</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fill_inds</span> <span class="o">=</span> <span class="n">map_old_cnf_files_to_new_svalues</span><span class="p">(</span><span class="n">added_svals</span><span class="p">,</span> <span class="n">in_old_svals</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">replica_add_scheme</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; </span><span class="se">\n</span><span class="s2"> ==&gt;Final cnf Mapping: &quot;</span><span class="p">,</span> <span class="n">fill_inds</span><span class="p">)</span>

    <span class="c1"># COPY</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">COPY CNFs in place: &quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">old_cnf_indx</span><span class="p">,</span> <span class="n">new_cnf_indx</span> <span class="ow">in</span> <span class="n">fill_inds</span><span class="p">:</span>
        <span class="n">new_cnf_name</span> <span class="o">=</span> <span class="n">out_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_cnf_indx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.cnf&quot;</span>
        <span class="n">new_cnf_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bash</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">in_old_cnf_files</span><span class="p">[</span><span class="n">old_cnf_indx</span><span class="p">],</span> <span class="n">new_cnf_name</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="s2"> -&gt; </span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">in_old_cnf_files</span><span class="p">[</span><span class="n">old_cnf_indx</span><span class="p">]),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">new_cnf_name</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done!</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_cnf_files</span></div>


<div class="viewcode-block" id="add_cnf_sopt_LRTOlike"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.add_cnf_sopt_LRTOlike">[docs]</a><span class="k">def</span> <span class="nf">add_cnf_sopt_LRTOlike</span><span class="p">(</span><span class="n">in_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">in_old_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                          <span class="n">in_new_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                          <span class="n">cnf_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sopt_run&quot;</span><span class="p">,</span>
                          <span class="n">replica_add_scheme</span><span class="p">:</span> <span class="n">add_scheme</span> <span class="o">=</span> <span class="n">add_scheme</span><span class="o">.</span><span class="n">from_bothSides</span><span class="p">,</span>
                          <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;add_cnf_sopt_LRTOlike</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_dir : str</span>
<span class="sd">        path where input cnf files are located</span>
<span class="sd">    out_dir : str</span>
<span class="sd">        path to output directory</span>
<span class="sd">    in_old_svals : list</span>
<span class="sd">        list of old s-values</span>
<span class="sd">    in_new_svals : list</span>
<span class="sd">        list of new s-values</span>
<span class="sd">    cnf_prefix : str, optional</span>
<span class="sd">        prefix for output cnf files (default &quot;sopt_run&quot;)</span>
<span class="sd">    replica_add_scheme : add_scheme, optional</span>
<span class="sd">        enum for addition scheme from class adding_Scheme_new_Replicas (default from_bothSides)</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]</span>
<span class="sd">        list of new cnf files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">replica_add_scheme</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Please provide only one adding scheme for adding the new replicas.&quot;</span><span class="p">)</span>

    <span class="n">new_cnf_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">in_old_svals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">in_old_svals</span><span class="p">)))</span>
    <span class="n">in_new_svals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">in_new_svals</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;): &quot;</span><span class="p">,</span> <span class="n">in_new_svals</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;old(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;): &quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;s value number difference (offfset): &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">))</span>

    <span class="n">in_prefix</span> <span class="o">=</span> <span class="n">in_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">cnf_prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
    <span class="n">out_prefix</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">cnf_prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">in_folder: &quot;</span> <span class="o">+</span> <span class="n">in_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;out_folder: &quot;</span> <span class="o">+</span> <span class="n">out_dir</span><span class="p">)</span>

    <span class="c1"># find added Svals:</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)):</span>
        <span class="n">added_svals</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">identify_closest_svalue</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">,</span> <span class="n">in_old_svals</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ==&gt;add replicas at positions :&quot;</span><span class="p">,</span> <span class="n">added_svals</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;could not map new_svals to old_sval! probably an rounding error - checkout accuracy.</span><span class="se">\n</span><span class="s2"> Found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">offset</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; insertion sites. Should be: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)))</span>

        <span class="c1"># add cnfs if needed?</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Adding cnf files?&quot;</span><span class="p">)</span>
        <span class="n">old_cnfs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">in_dir</span> <span class="o">+</span> <span class="s2">&quot;/*cnf&quot;</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.cnf&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))))</span>
        <span class="n">num_old_cnf_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_cnfs</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">num_old_cnf_files</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)):</span>  <span class="c1"># error check</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;There were more cnf files found than old_svalues! - This means that the coordinate files may not sequentially belong to the svals!</span><span class="se">\n</span><span class="s2"> old_svals: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">in_old_svals</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> cnfs: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">old_cnfs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># map cnfs to new svals</span>
            <span class="n">fill_inds</span> <span class="o">=</span> <span class="n">add_map_old_cnf_files_to_new_svalues</span><span class="p">(</span><span class="n">added_svals</span><span class="p">,</span> <span class="n">in_old_svals</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">replica_add_scheme</span><span class="p">,</span>
                                                             <span class="n">verbose</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; </span><span class="se">\n</span><span class="s2"> ==&gt;Final cnf Mapping: &quot;</span><span class="p">,</span> <span class="n">fill_inds</span><span class="p">)</span>

            <span class="c1"># COPY</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">COPY CNFs in place: &quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">old_cnf_indx</span><span class="p">,</span> <span class="n">new_cnf_indx</span> <span class="ow">in</span> <span class="n">fill_inds</span><span class="p">:</span>
                <span class="n">new_cnf_name</span> <span class="o">=</span> <span class="n">out_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_cnf_indx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.cnf&quot;</span>
                <span class="n">new_cnf_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bash</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">old_cnfs</span><span class="p">[</span><span class="n">old_cnf_indx</span><span class="p">],</span> <span class="n">new_cnf_name</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="s2"> -&gt; </span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">old_cnfs</span><span class="p">[</span><span class="n">old_cnf_indx</span><span class="p">]),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">new_cnf_name</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done!</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_cnf_files</span></div>


<div class="viewcode-block" id="map_old_cnf_files_to_new_svalues"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.map_old_cnf_files_to_new_svalues">[docs]</a><span class="k">def</span> <span class="nf">map_old_cnf_files_to_new_svalues</span><span class="p">(</span><span class="n">added_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                     <span class="n">in_old_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                     <span class="n">total_number_of_final_cnfs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                     <span class="n">replica_add_scheme</span><span class="p">:</span> <span class="n">add_scheme</span><span class="p">,</span>
                                     <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;map_old_cnf_files_to_new_svalues</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    added_svals : list</span>
<span class="sd">        list of new s-values</span>
<span class="sd">    in_old_svals : list</span>
<span class="sd">        list of old s-values</span>
<span class="sd">    total_number_of_final_cnfs: int</span>
<span class="sd">        number of output cnf files</span>
<span class="sd">    replica_add_scheme : add_scheme</span>
<span class="sd">        enum for addition scheme from class adding_Scheme_new_Replicas</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># do insert into coordinate Files</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;final_total_number_of_cnfs: &quot;</span><span class="p">,</span> <span class="n">total_number_of_final_cnfs</span><span class="p">)</span>
    <span class="n">number_of_cnfs_left</span> <span class="o">=</span> <span class="n">total_number_of_final_cnfs</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">s</span><span class="se">\t</span><span class="s2">add</span><span class="se">\t</span><span class="s2"> Sval</span><span class="se">\t\t</span><span class="s2">offset</span><span class="se">\t</span><span class="s2"> addingScheme&quot;</span><span class="p">)</span>
    <span class="c1"># determine cnf coordinate mapping from old s values to new s value structures</span>
    <span class="n">fill_inds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">added_svals</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">number_of_cnfs_left</span> <span class="o">-=</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:&gt;5.5f}</span><span class="se">\t\t</span><span class="si">{}</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">in_old_svals</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">number_of_cnfs_left</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># fill gap:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># Assign filling direction</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">added_svals</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">s</span> <span class="ow">and</span> <span class="p">(</span><span class="n">replica_add_scheme</span> <span class="o">==</span> <span class="n">add_scheme</span><span class="o">.</span><span class="n">from_below</span> <span class="ow">or</span>
                                                  <span class="p">(</span><span class="n">replica_add_scheme</span> <span class="o">==</span> <span class="n">add_scheme</span><span class="o">.</span><span class="n">from_bothSides</span> <span class="ow">and</span> <span class="n">added_svals</span><span class="p">[</span>
                                                      <span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))):</span>  <span class="c1"># check your not at bottom and this is the adding scheme from bottom or  both sides with only one new replica</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">add from below&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">fill_inds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">number_of_cnfs_left</span> <span class="o">+</span> <span class="p">(</span><span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>

            <span class="k">elif</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">added_svals</span><span class="p">)[</span>
                      <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">replica_add_scheme</span> <span class="o">==</span> <span class="n">add_scheme</span><span class="o">.</span><span class="n">from_bothSides</span><span class="p">):</span>  <span class="c1"># check your not at bottom and this is the adding scheme</span>
                <span class="n">half_range</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]))</span>

                <span class="n">add_svals_coords_from_below</span> <span class="o">=</span> <span class="p">[(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">number_of_cnfs_left</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                               <span class="nb">range</span><span class="p">(</span><span class="n">half_range</span><span class="p">)]</span>  <span class="c1"># add half coordinates from below</span>

                <span class="n">add_svals_coords_from_top</span> <span class="o">=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">number_of_cnfs_left</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                             <span class="nb">range</span><span class="p">(</span><span class="n">half_range</span><span class="p">,</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">])]</span>  <span class="c1"># add half coordinates from top</span>
                <span class="n">fill_inds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">add_svals_coords_from_below</span> <span class="o">+</span> <span class="n">add_svals_coords_from_top</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">add from bothSides: </span><span class="se">\t</span><span class="s2">Half&quot;</span><span class="p">,</span> <span class="n">half_range</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">from bot: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">add_svals_coords_from_below</span><span class="p">)),</span> <span class="n">add_svals_coords_from_below</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">top: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">add_svals_coords_from_top</span><span class="p">)),</span> <span class="n">add_svals_coords_from_top</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">add from top&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">fill_inds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">number_of_cnfs_left</span> <span class="o">+</span> <span class="p">(</span><span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fill_inds</span></div>


<div class="viewcode-block" id="add_map_old_cnf_files_to_new_svalues"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.add_map_old_cnf_files_to_new_svalues">[docs]</a><span class="k">def</span> <span class="nf">add_map_old_cnf_files_to_new_svalues</span><span class="p">(</span><span class="n">added_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                         <span class="n">in_old_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                         <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                         <span class="n">replica_add_scheme</span> <span class="p">:</span> <span class="n">add_scheme</span><span class="p">,</span>
                                         <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;add_map_old_cnf_files_to_new_svalues</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    added_svals : list</span>
<span class="sd">        list of new s-values</span>
<span class="sd">    in_old_svals : list</span>
<span class="sd">        list of old s-values</span>
<span class="sd">    offset: int</span>
<span class="sd">        offset to total amount of cnfs</span>
<span class="sd">    replica_add_scheme : add_scheme</span>
<span class="sd">        enum for addition scheme from class adding_Scheme_new_Replicas</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># do insert into coordinate Files</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">s</span><span class="se">\t</span><span class="s2">add</span><span class="se">\t</span><span class="s2"> Sval</span><span class="se">\t\t</span><span class="s2">offset</span><span class="se">\t</span><span class="s2"> addingScheme&quot;</span><span class="p">)</span>
    <span class="c1"># determine cnf coordinate mapping from old s values to new s value structures</span>
    <span class="n">fill_inds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">added_svals</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">offset</span> <span class="o">-=</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:&gt;5.5f}</span><span class="se">\t\t</span><span class="si">{}</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">in_old_svals</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">offset</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># fill gap:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># Assign filling direction</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">added_svals</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">s</span> <span class="ow">and</span> <span class="p">(</span><span class="n">replica_add_scheme</span> <span class="o">==</span> <span class="n">add_scheme</span><span class="o">.</span><span class="n">from_below</span> <span class="ow">or</span>
                                                  <span class="p">(</span><span class="n">replica_add_scheme</span> <span class="o">==</span> <span class="n">add_scheme</span><span class="o">.</span><span class="n">from_bothSides</span> <span class="ow">and</span> <span class="n">added_svals</span><span class="p">[</span>
                                                      <span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))):</span>  <span class="c1"># check your not at bottom and this is the adding scheme from bottom or  both sides with only one new replica</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">add from below&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">fill_inds</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">])])</span>

            <span class="k">elif</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">added_svals</span><span class="p">)[</span>
                      <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">replica_add_scheme</span> <span class="o">==</span> <span class="n">add_scheme</span><span class="o">.</span><span class="n">from_bothSides</span><span class="p">):</span>  <span class="c1"># check your not at bottom and this is the adding scheme</span>
                <span class="n">half_range</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]))</span>

                <span class="n">add_svals_coords_from_below</span> <span class="o">=</span> <span class="p">[(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="p">(</span><span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                               <span class="nb">range</span><span class="p">(</span><span class="n">half_range</span><span class="p">)]</span>  <span class="c1"># add half coordinates from below</span>
                <span class="n">add_svals_coords_from_top</span> <span class="o">=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="p">(</span><span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                             <span class="nb">range</span><span class="p">(</span><span class="n">half_range</span><span class="p">,</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">])]</span>  <span class="c1"># add half coordinates from top</span>
                <span class="n">fill_inds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">add_svals_coords_from_below</span> <span class="o">+</span> <span class="n">add_svals_coords_from_top</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">add from bothSides: </span><span class="se">\t</span><span class="s2">Half&quot;</span><span class="p">,</span> <span class="n">half_range</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">from bot: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">add_svals_coords_from_below</span><span class="p">)),</span> <span class="n">add_svals_coords_from_below</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">top: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">add_svals_coords_from_top</span><span class="p">)),</span> <span class="n">add_svals_coords_from_top</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">add from top&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">fill_inds</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="n">fill_inds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">offset</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fill_inds</span></div>


<div class="viewcode-block" id="identify_closest_svalue"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.identify_closest_svalue">[docs]</a><span class="k">def</span> <span class="nf">identify_closest_svalue</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                            <span class="n">in_old_svals</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">relocate_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;identify_closest_svalue</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_new_svals : list</span>
<span class="sd">        list of new s-values</span>
<span class="sd">    in_old_svals : list</span>
<span class="sd">        list of old s-values</span>
<span class="sd">    relocate_all : bool, optional</span>
<span class="sd">        default False</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        added s-values</span>
<span class="sd">    int</span>
<span class="sd">        offset</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">added_svals</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">))}</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Checkout, where new Values were added: &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">new_s</span><span class="se">\t\t\t</span><span class="s2">nearestNum</span><span class="se">\t</span><span class="s2">nearNumIDX&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">s_new</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">):</span>
        <span class="c1"># determine needed accuracy</span>

        <span class="n">nearest_s_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s_new</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">nearest_s</span> <span class="o">=</span> <span class="n">in_old_svals</span><span class="p">[</span><span class="n">nearest_s_idx</span><span class="p">]</span>

        <span class="n">significant_decimals</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nearest_s</span><span class="p">)),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">s_new</span><span class="p">))])))</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># dynamic accuracy</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">nearest_s</span><span class="p">,</span> <span class="n">s_new</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">significant_decimals</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span>     <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\t</span><span class="si">{:8.5f}</span><span class="se">\t\t</span><span class="si">{:8.5f}</span><span class="se">\t</span><span class="si">{:8&gt;}</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s_new</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">nearest_s</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">nearest_s_idx</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">relocate_all</span><span class="p">):</span>
                <span class="n">added_svals</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">nearest_s_idx</span><span class="p">:</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">nearest_s_idx</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span>     <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;NEW</span><span class="se">\t</span><span class="si">{:8.5f}</span><span class="se">\t\t</span><span class="si">{:8.5f}</span><span class="se">\t</span><span class="si">{:8&gt;}</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s_new</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">nearest_s</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">nearest_s_idx</span><span class="p">))</span>
            <span class="n">added_svals</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">nearest_s_idx</span><span class="p">:</span> <span class="n">added_svals</span><span class="p">[</span><span class="n">nearest_s_idx</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>

    <span class="n">offset</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">added_svals</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">added_svals</span><span class="p">])</span>  <span class="c1"># offset to total amount of cnfs</span>
    <span class="k">return</span> <span class="n">added_svals</span><span class="p">,</span> <span class="n">offset</span></div>


<div class="viewcode-block" id="reduce_cnf_eoff"><a class="viewcode-back" href="../../../../_source/reeds.function_libs.file_management.html#reeds.function_libs.file_management.file_management.reduce_cnf_eoff">[docs]</a><span class="k">def</span> <span class="nf">reduce_cnf_eoff</span><span class="p">(</span><span class="n">in_num_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">in_opt_struct_cnf_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">in_current_sim_cnf_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">in_old_svals</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Number</span><span class="p">],</span>
                    <span class="n">in_new_svals</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Number</span><span class="p">],</span> <span class="n">out_next_cnfs_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">run_prefix</span><span class="o">=</span><span class="s2">&quot;sopt_run&quot;</span><span class="p">,</span>
                    <span class="n">s1_repetitions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">s_repeating_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;reduce_cnf_eoff</span>
<span class="sd">    This function should facilitate the transition from Eoff -&gt; sopt.</span>
<span class="sd">    Todo: think about adding replicas and also s_values dependent cnf</span>
<span class="sd">    selection. bschroed</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_num_states : int</span>
<span class="sd">        int which gives the number of states</span>
<span class="sd">    in_opt_struct_cnf_dir : str</span>
<span class="sd">        path to the optimized eds state .cnfs(each state</span>
<span class="sd">        needs to be present - depends on in_num_states)</span>
<span class="sd">    in_current_sim_cnf_dir : str</span>
<span class="sd">        the initial .cnf coordinates for the rest of the</span>
<span class="sd">        replicas</span>
<span class="sd">    in_old_svals : List[Number]</span>
<span class="sd">        list of old s-values</span>
<span class="sd">    in_new_svals : List[number]</span>
<span class="sd">        list of new s-values</span>
<span class="sd">    out_next_cnfs_dir : str</span>
<span class="sd">        where to store the resulting cnfs</span>
<span class="sd">    run_prefix : str, optional</span>
<span class="sd">        prefix_name for the var (default &quot;sopt_run&quot;)</span>
<span class="sd">    s1_repetitions : int, optional</span>
<span class="sd">        how many repetitions of s1? (default None)</span>
<span class="sd">    s_repeating_value : float, optional</span>
<span class="sd">        value of s1 (default 1.0)</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        verbose output (default False)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]</span>
<span class="sd">        returns the paths of the list of reduced cnfs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">collected_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">out_num_svals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)</span>
    <span class="n">in_num_svals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s1_repetitions</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">s1_repetitions</span> <span class="ow">and</span> <span class="n">in_new_svals</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">s_repeating_value</span><span class="p">)</span> <span class="o">==</span> <span class="n">in_num_states</span><span class="p">):</span>
        <span class="n">s1_repetitions</span> <span class="o">=</span> <span class="n">in_num_states</span>
    <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">s1_repetitions</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;please specify any state repetitions&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">in_num_svals</span> <span class="o">&lt;=</span> <span class="n">out_num_svals</span> <span class="o">-</span> <span class="n">s1_repetitions</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;There are more new s values than old ones! This method only reduces the range of s-values.</span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Old = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">in_num_svals</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> New= &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_num_svals</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">s1_repetitions</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; s1Repetitions + &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">out_num_svals</span> <span class="o">-</span> <span class="n">in_num_states</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; samplingSvals)</span><span class="se">\n</span><span class="s2">&quot;</span>
                                             <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">OLD S-vals: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                                                                                    <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New S-vals: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">in_new_svals</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># general information</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">GENERAL INFO&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">num states: &quot;</span><span class="p">,</span> <span class="n">in_num_states</span><span class="p">,</span> <span class="s2">&quot;out_num svals: &quot;</span><span class="p">,</span> <span class="n">out_num_svals</span><span class="p">,</span> <span class="s2">&quot;in_num_svals: &quot;</span><span class="p">,</span> <span class="n">in_num_svals</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">picks :&quot;</span><span class="p">,</span> <span class="n">out_num_svals</span> <span class="o">-</span> <span class="n">in_num_states</span><span class="p">)</span>

    <span class="c1"># get optimized structs cnfs:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">GET in_opt_struct_cnf_dir cnfs&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">opt, PATH: &quot;</span><span class="p">,</span> <span class="n">in_opt_struct_cnf_dir</span> <span class="o">+</span> <span class="s2">&quot;/*cnf&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">cur_path = &quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

    <span class="n">found_cnfs</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">in_opt_struct_cnf_dir</span> <span class="o">+</span> <span class="s2">&quot;/*cnf&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">found_cnfs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">found_cnfs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Could not find any cnf file for next dir in: &quot;</span> <span class="o">+</span> <span class="n">in_opt_struct_cnf_dir</span> <span class="o">+</span> <span class="s2">&quot;/*cnf&quot;</span><span class="p">)</span>

    <span class="n">cnf_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">found_cnfs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.cnf&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">cnf_prefix</span> <span class="o">=</span> <span class="n">cnf_prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">old Opt Prefix:</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cnf_prefix</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NUmber of optimized states: &quot;</span><span class="p">,</span> <span class="n">in_num_states</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">in_num_states</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cnf_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.cnf</span><span class="se">\t</span><span class="s2">--&gt;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">out_next_cnfs_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">run_prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">state</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.cnf&quot;</span><span class="p">)</span>
        <span class="n">collected_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bash</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">in_opt_struct_cnf_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">cnf_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.cnf&quot;</span><span class="p">,</span>
                                              <span class="n">out_next_cnfs_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">run_prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.cnf&quot;</span><span class="p">))</span>

    <span class="c1"># get s_equil states cnfs:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">GET in_current_sim_cnf_dir cnfs&quot;</span><span class="p">)</span>
    <span class="c1">##coherent sorting:</span>
    <span class="n">simulation_result_cnf</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">in_current_sim_cnf_dir</span> <span class="o">+</span> <span class="s2">&quot;/*cnf&quot;</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.cnf&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))))</span>
    <span class="n">in_new_svals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">s_repeating_value</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">in_new_svals</span><span class="p">)))))</span>
    <span class="n">in_old_svals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">in_old_svals</span><span class="p">))))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">simulation_result_cnf</span><span class="p">)</span>

    <span class="c1">##neW</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">simulation_result_cnf</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Found less simulated result cnf files than there were old s values?</span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">svals(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                                                                                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">cnfs(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">simulation_result_cnf</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">simulation_result_cnf</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">s</span><span class="se">\t\t\t</span><span class="s2">nearestNum</span><span class="se">\t</span><span class="s2">nearNumIDX</span><span class="se">\t</span><span class="s2">used_cnf -&gt; copied to&quot;</span><span class="p">)</span>

    <span class="c1"># copy cnf with the closest old s_value (lleft oriented) for a new s_value</span>
    <span class="n">collected_files</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">new_index</span><span class="p">,</span> <span class="n">new_s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">):</span>
        <span class="n">closest_s_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">in_old_svals</span><span class="p">,</span> <span class="n">new_s</span><span class="p">)</span>
        <span class="n">closest_s</span> <span class="o">=</span> <span class="n">in_old_svals</span><span class="p">[</span><span class="o">-</span><span class="n">closest_s_idx</span><span class="p">]</span>
        <span class="n">tmp_cnf_path</span> <span class="o">=</span> <span class="n">simulation_result_cnf</span><span class="p">[</span><span class="n">closest_s_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">tmp_new_cnf_path</span> <span class="o">=</span> <span class="n">out_next_cnfs_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">run_prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">in_new_svals</span><span class="p">)</span> <span class="o">-</span> <span class="n">new_index</span> <span class="o">+</span> <span class="n">in_num_states</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.cnf&quot;</span>
        <span class="n">collected_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bash</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">tmp_cnf_path</span><span class="p">,</span> <span class="n">tmp_new_cnf_path</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{:8.5f}</span><span class="se">\t\t</span><span class="si">{:8.5f}</span><span class="se">\t</span><span class="si">{:8&gt;}</span><span class="se">\t\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">new_s</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">closest_s</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">closest_s_idx</span><span class="p">,</span>
                                                         <span class="n">tmp_cnf_path</span> <span class="o">+</span> <span class="s2">&quot;  -&gt;  &quot;</span> <span class="o">+</span> <span class="n">tmp_new_cnf_path</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">collected_files</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Benjamin Ries, Salome Rieder, Candide Champion. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.3

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>